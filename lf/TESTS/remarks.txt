2023-09-08
-----------

В процессе миграции данных  по БФЛ в Дагестане  выявлено порядка 1500 адресов, которые есть в ФИАСе, но отсутствуют в адресном справочнике БФЛ и СРМ. 

Необходимо:

    Выявить причину по которой данные адреса отсутствуют в справочнике СРМ
    Доработать (при необходимости) алгоритм обновления справочника ФИАС, чтобы все адреса попадали в справочник

Реестр  ЛС с отсутствующими адресами (в колонке ГУИД действительные идентификаторы ФИАС) во вложении.


2023-09-25
----------

1) ПОИСК отсутсвующих адресов.
     Дополнительно, где ищем ?????   GAR_FIAS
                                     history

-+ 2) Самое главное, определить типы неуществующих адресов.  ???  (Дома, н не все)

++ 3) Ещё более важное -- создать таблицу.

++ 4) Ещё более важное -- выбрать схему, в которой будет хранится рабочая таблица.

++ 5) Хост для работы.


----------------------------------------------------------------------
2023-09-26 

             -+ Какие UUIDs домов попали в центральную БД. 
             -+ Какие UUIDs домов попали в БД-05.
             -+ Какие UUIDs домов есть GAR_FIAS
             
2023-09-27
          
             -- Нужен стенд для отладки
             
                 ++  Текущая БД
                 ++  05  (01 -- 10)
                 --  Целый кластер ???
                 
++ pg_dump -h 10.196.35.165 -U postgres -p 5432 -a -f unnsi_prd_test_20230927.sql unnsi_prd_test 1> d.out 2>d.err &                 

++ pg_dump -h 10.196.35.165 -U postgres -p 5432 -C -f unsi_test_01_20230927.sql unsi_test_01 1> d01.out 2>d01.err &                 
++ pg_dump -h 10.196.35.165 -U postgres -p 5432 -C -f unsi_test_02_20230927.sql unsi_test_02 1> d02.out 2>d02.err &                 
++ pg_dump -h 10.196.35.165 -U postgres -p 5432 -C -f unsi_test_03_20230927.sql unsi_test_03 1> d03.out 2>d03.err &                 
++ pg_dump -h 10.196.35.165 -U postgres -p 5432 -C -f unsi_test_04_20230927.sql unsi_test_04 1> d04.out 2>d04.err &                  
++ pg_dump -h 10.196.35.165 -U postgres -p 5432 -C -f unsi_test_05_20230927.sql unsi_test_05 1> d05.out 2>d05.err &                               
++ pg_dump -h 10.196.35.165 -U postgres -p 5432 -C -f unsi_test_06_20230927.sql unsi_test_06 1> d06.out 2>d06.err &                  
++ pg_dump -h 10.196.35.165 -U postgres -p 5432 -C -f unsi_test_07_20230927.sql unsi_test_07 1> d07.out 2>d07.err &                  
++ pg_dump -h 10.196.35.165 -U postgres -p 5432 -C -f unsi_test_08_20230927.sql unsi_test_08 1> d08.out 2>d08.err &                  
++ pg_dump -h 10.196.35.165 -U postgres -p 5432 -C -f unsi_test_09_20230927.sql unsi_test_09 1> d09.out 2>d09.err &                  
++ pg_dump -h 10.196.35.165 -U postgres -p 5432 -C -f unsi_test_10_20230927.sql unsi_test_10 1> d10.out 2>d10.err &

--------------------------------
Мучения от собственной глупости.
DROP SERVER IF EXISTS unnsi_prd_s;
CREATE SERVER unnsi_prd_s FOREIGN DATA WRAPPER postgres_fdw
    OPTIONS (dbname 'unnsi_prd_test', host '127.0.0.1', port '5434');
    
#  Помнить об этом нужно    
./post_proc.sh /home/n.chadaev@abrr.local/tmp up_prds_20230925
./


-- Модификация функции  (0, 1, 2)
-- Модификаця таблицы
-- Контрольный запрос 53.

-- Чьи это идентификаторы ????  Почему они не находятся.


2023-09-28 -- Записи без родителей ( 111 домов)
------------
Задача: пересмотреть запрос формирующий  список-агрегат адресных пространств
        Восстановить нарушенную целостнность БД.
        
Как делаем ?   (111 домов)
     1) JOIN С РОДИТЕЛЯМИ    as_addr_obj, ЕСТЬ ЛИ ОНИ ???


Записи без родителей.
-- home JOIN с as_addr_obj --есть ли они ?

2023-10-02  --  Кривой запрос был. У всех "потерянный" был правильный родитель.
----------      
  -- Проверить агрегацию.
  --
  
2023-10-03   Формирование буферной таблицы.  
----------
   unnsi - сторонняя схема, таблицы в ней не изменяются.
   gar_tmp - локальная схема, таблицы в ней модифицируются.
   
   Этапы:
          -- формирование буферной  таблицы, контроль log.
          -- обновления:
                -- адресные пространства,
                -- улицы,
                -- дома.
                
   LOGs

[22:14:17] ...     -- Очистка данных во временной схеме.   
   
[22:14:39] ...     -- Агрегация данных
[22:14:39] ...     -- Агрегация параметров
[22:14:48] ...     -- Агрегация адресных пространств
[22:14:49] ...     -- Агрегация домовладений
[22:14:57] ...     -- Заполнение управляющей таблицы "gar_tmp.xxx_obj_fias"
   
   
Это потом:

[22:15:06] ...  -- stage_41r (Обработка данных)
[22:15:06] ...     -- Адресные регионы, дополнение
[22:15:06] ...     -- Адресные регионы, обновление
[22:15:09] ...     -- Элемент улично-дорожной сети, дополнение
[22:15:10] ...     -- Элемент улично-дорожной сети, обновление
[22:15:33] ...     -- Здания (сооружения), дополнение
[22:15:34] ...     -- Здания (сооружения), обновление




 f_xxx_adr_area_set_data 
-------------------------
                   26250
(1 row)

 f_xxx_adr_house_set_data 
--------------------------
                   617502
(1 row)

 f_xxx_obj_fias_set_data 
-------------------------
                    2065
                   24185
                  611622
(3 rows)

 id_un_export | dt_gar_version | kd_export_type | id_region | nm_area_full  |         dt_export          | nm_user  | seq_value | node_id | id_un_export_by_obj | sch_name | nm_object  | qty_main | qty_aux |                               file_path                                | fserver_name |   host    |     dbname     | port | db_conn_name  
--------------+----------------+----------------+-----------+---------------+----------------------------+----------+-----------+---------+---------------------+----------+------------+----------+---------+------------------------------------------------------------------------+--------------+-----------+----------------+------+---------------
           67 | 0223-09-25     | f              |         6 | Дагестан Респ | 2023-09-26 22:21:46.893425 | postgres | 600071179 |       1 |                 199 | gar_tmp  | adr_area   |     2096 |       7 | /home/n.chadaev@abrr.local/tmp/up_prds_2230925/DATA/adr_area_06.sql    | unnsi_prd_s  | 127.0.0.1 | unnsi_prd_test | 5432 | c_unnsi_prd_s
           67 | 0223-09-25     | f              |         6 | Дагестан Респ | 2023-09-26 22:21:46.893425 | postgres | 600071179 |       1 |                 200 | gar_tmp  | adr_street |    25477 |      55 | /home/n.chadaev@abrr.local/tmp/up_prds_2230925/DATA/adr_street_06.sql  | unnsi_prd_s  | 127.0.0.1 | unnsi_prd_test | 5432 | c_unnsi_prd_s
           67 | 0223-09-25     | f              |         6 | Дагестан Респ | 2023-09-26 22:21:46.893425 | postgres | 600071179 |       1 |                 201 | gar_tmp  | adr_house  |   663156 |     356 | /home/n.chadaev@abrr.local/tmp/up_prds_2230925/DATA/adr_house_06.sql   | unnsi_prd_s  | 127.0.0.1 | unnsi_prd_test | 5432 | c_unnsi_prd_s

----------------------------------------------------------------- 
 
DELETE FROM ONLY gar_tmp.xxx_adr_area;         -- Временная таблица. заполняется данными из "AS_ADDR_OBJ", "AS_REESTR_OBJECTS", "AS_ADM_HIERARCHY", "AS_MUN_HIERARCHY", "AS_OBJECT_LEVEL", "AS_STEADS_PARAMS"
DELETE FROM ONLY gar_tmp.xxx_adr_house;	       -- Адреса домов 
DELETE FROM ONLY gar_tmp.xxx_obj_fias;         -- Дополнительная связь адресных объектов с ГАР-ФИАС
DELETE FROM ONLY gar_tmp.xxx_type_param_value; -- Для каждого объекта хранятся агрегированные пары "Тип" - "Значение"

SELECT * FROM gar_tmp_pcg_trans.f_xxx_adr_area_set_data();
SELECT * FROM gar_tmp_pcg_trans.f_xxx_adr_house_set_data();
SELECT * FROM gar_tmp_pcg_trans.f_xxx_obj_fias_set_data('gar_tmp','gar_tmp','gar_tmp');
SELECT * FROM gar_tmp_pcg_trans.f_set_params_value();

-------------------------------------------------------------------------------------

DELETE FROM ONLY gar_tmp.xxx_adr_area;         --   26250
DELETE FROM ONLY gar_tmp.xxx_adr_house;	       --  617502
DELETE FROM ONLY gar_tmp.xxx_obj_fias;         --  637872
DELETE FROM ONLY gar_tmp.xxx_type_param_value; -- 1065890

-- Идиот, обновлять aux !!!
SELECT * FROM gar_tmp.adr_area_aux;
------------------------------------
id_area	op_sign
192259	U
192263	U     <----- Старьё  
192331	U
22872	U
----------
208140	U
208184	U
208173	U

SELECT * FROM gar_tmp.adr_street_aux;
DELETE FROM gar_tmp.adr_street_aux;
--
SELECT * FROM gar_tmp.adr_house_aux;
DELETE FROM gar_tmp.adr_house_aux;



SELECT * FROM gar_tmp_pcg_trans.f_xxx_adr_area_set_data();   --  26509
SELECT * FROM gar_tmp_pcg_trans.f_xxx_adr_house_set_data();  -- 617502
SELECT * FROM gar_tmp_pcg_trans.f_xxx_obj_fias_set_data('gar_tmp','gar_tmp','gar_tmp');

   --   2076
   --  24433
   -- 617487  --  15 ??

SELECT * FROM gar_tmp_pcg_trans.f_set_params_value(); -- 1065890


SELECT * FROM gar_tmp.xxx_obj_fias;
SELECT * FROM gar_tmp.xxx_obj_fias WHERE (type_object = 2) AND (id_obj IS NULL); -- 6494
SELECT * FROM gar_tmp.xxx_obj_fias WHERE (type_object = 1) AND (id_obj IS NULL); --  298
SELECT * FROM gar_tmp.xxx_obj_fias WHERE (type_object = 0) AND (id_obj IS NULL); --   19

SELECT * FROM gar_tmp.xxx_obj_fias f
   INNER JOIN public.fias_not_found_06u u ON (u.guid = f.obj_guid) -- 160   60 ??

SELECT * FROM public.fias_not_found_06u; -- 220
--
--  Установка последовательностей.
--
SELECT gar_tmp_pcg_trans.f_xxx_obj_seq_crt (
              p_seq_name      := 'gar_tmp.obj_seq' -- Имя последовательности
             ,p_id_region     := 6                 -- ID региона
             ,p_init_value    := 100000000         -- Начальное значение
);

Что произошло с функционалом обновления/дополнения.

SELECT * FROM gar_tmp.xxx_obj_fias WHERE (type_object = 2) AND (id_obj IS NULL); -- 6494
SELECT * FROM gar_tmp.xxx_obj_fias WHERE (type_object = 1) AND (id_obj IS NULL); --  298
SELECT * FROM gar_tmp.xxx_obj_fias WHERE (type_object = 0) AND (id_obj IS NULL); --   19


Почему не дополнились, не обновились ???
----------------------------------------
SELECT * FROM gar_tmp.xxx_obj_fias WHERE (type_object = 2) AND (id_obj IS NULL); -- 6494
SELECT * FROM gar_tmp.xxx_obj_fias WHERE (type_object = 1) AND (id_obj IS NULL); --  298
SELECT * FROM gar_tmp.xxx_obj_fias WHERE (type_object = 0) AND (id_obj IS NULL); --   19

SELECT aa.* FROM gar_tmp.xxx_adr_area aa --  19
   INNER JOIN gar_tmp.xxx_obj_fias xx ON (aa.fias_guid = xx.obj_guid) 
WHERE ((xx.type_object = 0) AND (xx.id_obj IS NULL));   

SELECT aa.* FROM gar_tmp.xxx_adr_area aa -- 298
   INNER JOIN gar_tmp.xxx_obj_fias xx ON (aa.fias_guid = xx.obj_guid) 
WHERE ((xx.type_object = 1) AND (xx.id_obj IS NULL))-- and (nm_addr_obj = 'Юннатов');

SELECT hh.* FROM gar_tmp.xxx_adr_house hh -- 6494
   INNER JOIN gar_tmp.xxx_obj_fias xx ON (hh.fias_guid = xx.obj_guid) 
WHERE ((xx.type_object = 2) AND (xx.id_obj IS NULL)) ;

SELECT hh.* FROM gar_tmp.xxx_adr_house hh -- 111 !!!  и ДОЛЖНЫ ОБНОВЛЯТЬСЯ
   INNER JOIN gar_tmp.xxx_obj_fias xx ON (hh.fias_guid = xx.obj_guid) 
   INNER JOIN public.fias_not_found_06u n ON (hh.fias_guid = n.guid)    
WHERE ((xx.type_object = 2) AND (xx.id_obj IS NULL)) ;


2023-10-04  Что, почему появились "бездомные"
----------


2023-10-05   Пока "несложное и туповатое".
----------    
              02 - Башкирия, посмотрим, будут ли похожие результаты.
                   -- Собрать пакет + view
                   -- Модификация xxx-справочника типов.
                   -- Перезагрузка xxx-таблиц
                   -- Тестовое обновление.
                   
commit 636a458190586e2621d20376bf0ff7820f4dc6f9 (origin/FilterObj)
Author: Чадаев Николай <n.chadaev.tech>
Date:   Wed Oct 4 17:44:43 2023 +0300

    Решение FIX-5

2023-10-06   10 домов, чём причина их потери. Строим тестовое view.
-------------------------------------------------------------------

1) Есть ли у этих  10 домов родители.
2) Если есть, то какие

До конца решено не было.
-------------------------                    

2023-10-09
-----------

  ++  Собрать пакет от 2023-10-06

  ++  Обновление кластер 2

  ++  stage_31r.yaml -- коррекция.

  ++  Бухгалтерия заработала после перезапуска Linux.

  !!  Локальный и удалённые репозитории GIT --сущности различные,
      git pull origin ... вызовет слияние локальной (текущей ветки) и отдалённой веток.
      Таким образом забацал FilterObj в master.
      
  ++ Новый patch для обновления промежуточного справочника адресных пространств.
  

  2023-10-10
  ----------
  
     ++ Посмотреть  log 06, 24 (Дагестан, Краснодар)
        И смотрим локальные БД  (05, 23)  Сочи, Центральный р-н (БЫЛО всё потеряно).
     
     -- Описание, не приводить примеры.  Краснодарский край
     
    SELECT id, object_id, object_guid, change_id, object_name, type_id, type_name
         , obj_level, oper_type_id, prev_id, next_id, update_date, start_date, end_date
         , is_actual, is_active
	FROM gar_fias.as_addr_obj WHERE (object_name = 'Барановка') AND (end_date > NOW());     
     
    Это соотносится с проблемой "активных" предшественников. В случае улиц в Дагестане,
    непонятно то, где была найдена такая улица, неактивная, но неистёкшим сроком актуальностию.
     
     Основная причина "пропажи" адресов заключается в том, что оставшееся от советских времён
     городское районное административное деление может описываеться в БД ГАР-ФИАС записями
     с уровнем 14 и выше, такие записи, являются активными, но период их актуальности 
     закончился. Подчинённые им записи (улицы и дома), так-же могут быть активными, но с 
     неистёкшим периодом актуальности. Это обстоятельство потребовало модификации функции
     "gar_tmp_pcg_trans.f_xxx_adr_area_show_data()", "gar_tmp_pcg_trans.f_xxx_obj_fias_show_data_0/1/2()"
     с целью исключения "пропажи" подчинённых адресных объектов.
     
     Земельные участки, В настоящее  время их данные загружаются в таблицы "gar_fias.as_steads" и
     "gar_fias.as_steads_params". Это первичная загрузка.
     
     Необходимо определить структуру таблицы в схеме "unnsi" для хранения данных о земельных 
     участкаъх, расширить функциональный пакет "gar_tmp_pcg_trans", выполнить доработку python-скриптов.
     -----------------------------------------------------------------------------------------------
     
     -- Подумать о загрузке земельных участков.
        До уровня агрегатов всё будет традиционно,
        далеее выбор: новая таблица, либо  "adr_objects".
        
     -- Параметры земельных участков.     
        
        
     -- "_COMMON" подумать, как отшлифовать её (надо готовить задание для ticker).
     
     -- Активные предщественники, подумать об оптимизации.  !!!!!!!!!!!!!!!!!!!
     -- 
     
     2023-10-10
     -----------
2023-10-11 00:14:12,012 WARNING pg-perfect-ticker ticker task ('r0', 'bg_thr_pool_r', 'exchange_db_con'): error <class 'SystemExit'>: 256
Московская область -- разобраться. !!!!!

ОШИБКА:  команда ON CONFLICT DO UPDATE не может менять строку повторно
HINT:  Проверьте, не содержат ли строки, которые должна добавить команда, дублирующиеся значения, подпадающие под ограничения.
CONTEXT:  SQL-оператор: "INSERT INTO gar_tmp.xxx_adr_area AS z (
----------------------------------------------------------------
               ON CONFLICT (id_addr_obj) DO 
               
               UPDATE
                    SET
                          id_addr_parent   = excluded.id_addr_parent    
                         ,fias_guid        = excluded.fias_guid       
                         ,parent_fias_guid = excluded.parent_fias_guid
                         ,nm_addr_obj      = excluded.nm_addr_obj    
                         ,addr_obj_type_id = excluded.addr_obj_type_id                            
                         ,addr_obj_type    = excluded.addr_obj_type   
                         ,obj_level        = excluded.obj_level       
                         ,level_name       = excluded.level_name      
                          --
                         ,region_code      = excluded.region_code -- 2021-12-01
                         ,area_code        = excluded.area_code  
                         ,city_code        = excluded.city_code  
                         ,place_code       = excluded.place_code 
                         ,plan_code        = excluded.plan_code  
                         ,street_code      = excluded.street_code
                          --                                 
                         ,oper_type_id     = excluded.oper_type_id    
                         ,oper_type_name   = excluded.oper_type_name
                          --
                         ,start_date       = excluded.start_date  -- 2021-12-06
                         ,end_date         = excluded.end_date
                          -- 
                         ,tree_d           = excluded.tree_d          
                         ,level_d          = excluded.level_d         
                  
               WHERE (z.id_addr_obj = excluded.id_addr_obj)"



----------------------------------------------------------------

1) Осталось 252 файла. 
            2) Остановка ticker'ab
            3) Разобраться отдельно.
            
         SELECT   x.id_addr_obj      
                  ,x.id_addr_parent   
                  ,x.fias_guid        
                  ,x.parent_fias_guid 
                  ,x.nm_addr_obj  
                  ,x.addr_obj_type_id     
                  ,x.addr_obj_type    
                  ,x.obj_level        
                  ,x.level_name
                   --
                  ,x.region_code  -- 2021-12-01
                  ,x.area_code    
                  ,x.city_code    
                  ,x.place_code   
                  ,x.plan_code    
                  ,x.street_code    
                   --                                 
                  ,x.oper_type_id     
                  ,x.oper_type_name  
                   --
                  ,x.start_date 
                  ,x.end_date  
                   --                  
                  ,x.tree_d           
                  ,x.level_d          
          
          FROM gar_tmp_pcg_trans.f_xxx_adr_area_show_data (
              p_date          := DATE(current_date)::date     -- Дата, на которую выбираются данные
             ,p_obj_level     := 16::bigint   -- Уровень объекта
             ,p_oper_type_ids := NULL::bigint[] -- Типы операций.
          ) x 
          
          00:22:49] ... [00:22:49]: Error, rc = 256
[00:22:49] ...             psql -h 127.0.0.1 -p 5432 -c "SELECT gar_tmp_pcg_trans.f_xxx_adr_area_set_data (
              p_date          := DATE(current_date)::date     -- Дата, на которую выбираются данные
             ,p_obj_level     := 16::bigint   -- Уровень объекта
             ,p_oper_type_ids := NULL::bigint[] -- Типы операций.
        );
        
 3) счётчик не работает
 
2023-10-12 -- Индексное покрытие ???
----------

   Причина появления дублей (только Московская область). БЛИЖАЙШИЕ РОДИТЕЛИ, ВОТВ ЧЁМ ПРИЧИНА.
   -- адресные объекты  -- тестовое представление
   -- дома
   
  -- адресные объекты, вторая часть рекурсивного запроса, выполняется нормально,
     как с признаком активности, так и без него.
     (номальное выполнение, это 5 адресных объектов, отображающихся без дублей).
     
   -- адресные объекты, полный рекурсивный запрос:    (здесь есть объекты, не имеющие дублей !!!!)
         -- нормально признак активности включен везде.
         -- признак активности выключен только в опорной части.
         -- признаки активности  выключены везде.  ЗАДВОЕНИЕ !!
           
         
   -- План запроса  
         -- признак активности выключен только в опорной части.
     
  -- адресные объекты,
  
--==============================================================================================
2023-10-13
----------

Теперь проверить на 05, будет ли разница??
  -- В зависимой части признак активности выключен / включён.   26531 | 26520  with active  26525 ??
  
  -- Индексное покрытие над GAR_FIAS -- ЧАСТИЧНАЯ РЕВИЗИЯ. 

  -- l0.py отработал нормально, просто у него длительное время сна. 

  
 -- 
2023-10-19 Артефакты, вылывшие при пробной обработке ЗУ.
----------
Артефакты.
---------
nm_fias_guid_parent                 |nm_parent_obj|region_code|parent_type_id|parent_type_name            |parent_level_id|parent_level_name              |
------------------------------------+-------------+-----------+--------------+----------------------------+---------------+-------------------------------+
354baa65-215d-4df5-aec0-1b6dbfada0c9|Пшеничная    |5          |           204|Улица                       |              8|Элемент улично-дорожной сети   |
3be41afe-4ae9-4a1b-8e22-9990e07ee7ff|Мостовая     |5          |           204|Улица                       |              8|Элемент улично-дорожной сети   |
5b8bba72-59a1-4e73-b917-848e7dd36c32|Ахульго      |5          |           204|Улица                       |              8|Элемент улично-дорожной сети   |
64198789-a489-45d9-a15b-111f58d9009a|Финиковая    |5          |           204|Улица                       |              8|Элемент улично-дорожной сети   |
7248f5e2-99b1-47e2-a5e4-190ea89df774|Ломаная      |5          |           204|Улица                       |              8|Элемент улично-дорожной сети   |
89e7b4b0-aa0c-4977-b631-79709c13a773|Шиназская    |5          |           204|Улица                       |              8|Элемент улично-дорожной сети   |
8d58ca8c-a65a-4370-a5d4-584f44ac5b73|Фруктовая    |5          |           204|Улица                       |              8|Элемент улично-дорожной сети   |
e31d0897-8a46-48d3-a213-7ae993c50de9|Благородная  |5          |           204|Улица                       |              8|Элемент улично-дорожной сети   |


7daa96c1-5e22-4f5a-a111-06cd36e229a9|Гаражная     |5          |           326|Улица                       |              7|Элемент планировоной структуры|


97299168-9004-412a-ae9c-558d4356c606|Серный       |5          |           158|Поселок                     |              8|Элемент улично-дорожной сети   |
43c3311c-9cc2-494c-8065-98f62396d78c|Приморский   |5          |           158|Поселок                     |              8|Элемент улично-дорожной сети   |
ccb32695-884a-4961-8bd7-c9e5a356f9ad|Рыбный       |5          |           158|Поселок                     |              8|Элемент улично-дорожной сети   |
f2f1d515-8536-4442-b44d-2544c5c39e95|Привольный   |5          |           158|Поселок                     |              8|Элемент улично-дорожной сети   |
f447f6c0-5d94-4033-b72a-4116bcc08a6b|Акъ-таш      |5          |           150|Местность                   |              8|Элемент улично-дорожной сети   |
f8cc583a-1e69-4ce0-944c-da6bdd4c110e|Красная роза |5          |           194|Садовое неком-е товарищество|              8|Элемент улично-дорожной сети   |
fc826836-3d68-465e-a176-ffa0568bceec|Баъли-бав    |5          |           150|Местность                   |              8|Элемент улично-дорожной сети   |

1) Путаница в типах
2) Путаница в уровнях
 
-- -------------------------------------------------------------------

2023-10-20  Слава Богу, что начал заниматься  земельными участками.
-------------------------------------------------------------------
Итоги:
======

  -- Очень внимательно определять окна, используя ID
 
  -- INSERT ( дополнение) -- дубль принудительно не обновлять полность.
     переводить его в историю, далее делать неактивным, оставляя в БД
     повторять впрерваннуб операцию
 
  -- UPDATE -- так-же дубль делать неактивным.
 
  -- Функции получающие атомарные записи работать будут, но без индексного покрытия.
 
  -- Что будет с функциями типа ++UPLOAD, 
                                  UNLOAD.  -- обратно деактивированные записи уже не попадут
                                              есть вероятность потери обновлений.
                                              (а если грузить все)
     ??
     и с функциями , выполняющими постобработку. деактивированные записи не попадают
     в процесс. ???
     
     Что делаем ??
       -- f_xxx_adr_area_show_data -- изменяю  определение окна.
       -- f_adr_area_ins -- ополнительное обращение к GAP-процедурам (at CONTINUE)
       -- p_adr_area_ins -- Деактивания вместо принудительного обновления и воздание 
                            новой записи.
                            
       В случае успреха -- повторить для street, house, as_steads
       
       -- p_adr_area_ins -- деактивания дубля.
       
     
  -- Не забывать про AUX-структуры.    
  
  --Проверить индесное покрытие и планы в процессе поиска активных предшественников.
  
  2023-10-21
  ----------
  unsi_test_05=# SELECT gar_tmp_pcg_trans.f_xxx_obj_fias_set_data ('gar_tmp', 'gar_tmp', 'gar_tmp', 'gar_tmp');
ЗАМЕЧАНИЕ:  отношение "__adr_area_fias" уже существует, пропускается
ЗАМЕЧАНИЕ:  отношение "__adr_area_fias" уже существует, пропускается
ЗАМЕЧАНИЕ:  отношение "__adr_area_fias" уже существует, пропускается

 f_xxx_obj_fias_set_data 
-------------------------
                    2086
                   24434
                  617506
                  295133
(4 строки)


2023-10-23
----------
select count (1) from gar_tmp.xxx_adr_area;  --  26520
select count (1) from gar_tmp.xxx_adr_house; -- 617693
select count (1) from gar_tmp.xxx_adr_stead; -- 295157
------------------------------------------------------

-- 1) adr_area -- создание и обновление, избежать "изменения" UUID.
      gap-таблицы.
      
-- 2) Очищать adr_area_aux

?? 3) Активные прешественники, улицы и дома.

--===============================================================================================

-- 3) Функции типа gap_put -- исключить обновление ON CONFLICT (практически пишется одно и то-же).
      Важно сохранить первоначальную дату.
      
-- 4) Пункт 1 - избежать изменения UUID приводит к появлению множественных "активных" записей.
        -- активная запись в эксплуатационном покрытии (один критерий актуальности)
        -- активная запись в процессинговом покрытии (два усиленных критерия актуальности).
        
   5) UUID нужны для поиска родителей, при добавлении/обновлении записей из ФИАС.
   
        -- Таблица "uuid_twins"
        
             -- UUID_ORIG uuid              -- PK    
             -- UUID_TWIN uuid              -- ie1 
             -- id_orig         -- ЕС НСИ.  -- ie2
             -- id_twin         -- ФИАС             ---??? НОВЫЙ !!!!
             -- type_object                 0, 1, 2, 3, 4 (4 steads) 
             
   6) Когда это происходит ????
   
             -- В момент обработки исключений (заполняется/создаётся) запись.
             -- ВАсе подчинённые строки обновляются -- единая структура.
             
                         
   7) Зачем нужно функции  "а_adr_xxx_get (схема GUID) --????? (для определения правильного
       родителя). 
--===============================================================================================
-- 2023-10-24 --
----------------
             
        # Заполнение таблицы с дефектными данными.
        self.gar_fias_set_adr_data = """SELECT gar_fias_pcg_load.f_adr_area_set_data (
              p_fias_guid := (gar_tmp_pcg_trans.f_adr_area_get('{0}',{1})).nm_fias_guid::uuid
             ,p_date      := '{2}'::date
             ,p_descr     := (gar_tmp_pcg_trans.f_adr_area_get('{0}',{1})).nm_area_full::text);"""     
             
        # Обработка таблицы с дефектными данными.
        self.gar_fias_addr_obj_update_children = """SELECT * FROM gar_fias_pcg_load.f_addr_obj_update_children (
         p_date_1    := '{0}'::date
        ,p_obj_level := ARRAY{1}::integer[]      
        ,p_date_2    := {2}::date           
        );"""             
             
                Как ??   адресные пространства --> адресные пространств, улицы, дома и земельные участки.
                         улицы                 -->        дома и земельные участки.   
                         дома                  -- ??? всё остаётся по прежнему ??
                         
 МИНИМАЛЬНЫЙ ОБЪЁМ ДОРАБОТОК, НЕОБХОДИМЫЙ ДЛЯ ВЫПУСКА НОВОГО РЕЛИЗА.
 
    1) f_xxx_adr_area_show()  -изменить определение окна
    2) load -- двойники.      -изменить определение окна.
    3) f_adr_area/street/home/ ins/upd   -- вместо CONTINUE,  обращение к GAP-функции.
    4) GAP-функции,  убрать UPDATE для исключения ON CONFLICT.  DO NOTING.
    
ВЫПУСКАТЬ НА master.  FilterObj - остаётся опытной платформой.
                      steads -- до лучших времён.
2023-10-25
----------

-- Список типов ФИАС, который необходимо переместится на уровень, отличный от 8
     +
-- Активные предшественники   

      -- gar_fias_pcg_load.f_addr_obj_get_twins()    -- Утилита
      -- gar_fias_pcg_load.f_addr_obj_get_parents()  -- Обеспечивает её работу.
      
   А это зачем  ???   
   
2023-10-26
----------
  Активные предшественники,
  Но сначала upgrade "fias_loader/DBMS/GAR_TMP_PCG_TRANS/gar_tmp_trans_pcg.sql" на большом хосте.
  До этого ...  9, 11 и 13 октября
  
$>git status
# On branch master
# Your branch is ahead of 'origin/master' by 28 commits.
#   (use "git push" to publish your local commits)
 ---------------------------------------------------------------------------------
 Updating 9a0b081..dc26bef
Fast-forward
 fias_loader/DBMS/GAR_TMP_PCG_TRANS/FUNCTION/f_adr_area_ins.sql            |    74 +-
 fias_loader/DBMS/GAR_TMP_PCG_TRANS/FUNCTION/f_adr_area_upd.sql            |    23 +-
 fias_loader/DBMS/GAR_TMP_PCG_TRANS/FUNCTION/f_adr_house_ins.sql           |    23 +-
 fias_loader/DBMS/GAR_TMP_PCG_TRANS/FUNCTION/f_adr_house_upd.sql           |    25 +-
 fias_loader/DBMS/GAR_TMP_PCG_TRANS/FUNCTION/f_adr_street_ins.sql          |    24 +-
 fias_loader/DBMS/GAR_TMP_PCG_TRANS/FUNCTION/f_adr_street_upd.sql          |    25 +-
 fias_loader/DBMS/GAR_TMP_PCG_TRANS/FUNCTION/f_xxx_adr_area_show_data.sql  |     8 +-
 fias_loader/DBMS/GAR_TMP_PCG_TRANS/PROCEDURE/p_xxx_adr_area_gap_put.sql   |    25 +-
 fias_loader/DBMS/GAR_TMP_PCG_TRANS/PROCEDURE/p_xxx_adr_house_gap_put.sql  |    36 +-
 fias_loader/DBMS/GAR_TMP_PCG_TRANS/PROCEDURE/p_xxx_adr_street_gap_put.sql |    24 +-
 fias_loader/DBMS/GAR_TMP_PCG_TRANS/gar_tmp_trans_pcg.err                  |   346 ++--
 fias_loader/DBMS/GAR_TMP_PCG_TRANS/gar_tmp_trans_pcg.err.bak              |   124 +-
 fias_loader/DBMS/GAR_TMP_PCG_TRANS/gar_tmp_trans_pcg.log                  |   172 +-
 fias_loader/DBMS/GAR_TMP_PCG_TRANS/gar_tmp_trans_pcg.log.bak              |   172 +-
 fias_loader/DBMS/GAR_TMP_PCG_TRANS/gar_tmp_trans_pcg.sql                  |   289 ++--
 fias_loader/DBMS/GAR_TMP_PCG_TRANS/gar_tmp_trans_pcg.sql.bak              |    85 +-
 fias_loader/DBMS/GAR_TMP_PCG_TRANS/stage_25_tmp_build.csv                 |     4 +-
 fias_loader/DBMS/GAR_TMP_PCG_TRANS/version.sql                            |     2 +-
 fias_loader/TESTS/X0_crt_view.sql                                         |   339 ++++
 fias_loader/TESTS/Y_BUILD/05/l.err                                        |   342 ++++
 fias_loader/TESTS/Y_BUILD/05/l.out                                        |   295 ++++
 fias_loader/TESTS/Y_BUILD/05/stage_4.1.sql                                |    39 +-
 fias_loader/TESTS/Y_BUILD/05/stage_4.2.sql                                |     9 +-
 fias_loader/TESTS/Y_BUILD/05/stage_4.3.sql                                |     8 +-
 fias_loader/TESTS/Y_BUILD/05/stage_4.4.sql                                |     8 +-
 fias_loader/TESTS/Y_BUILD/05/stage_4.5.sql                                |     6 +-
 fias_loader/TESTS/Y_BUILD/05/stage_4.6.sql                                |    14 +-
 fias_loader/TESTS/Y_BUILD/05/t411.err                                     |     0
 fias_loader/TESTS/Y_BUILD/05/t411.out                                     |    94 ++
 fias_loader/TESTS/Y_BUILD/05/t421.err                                     |     0
 fias_loader/TESTS/Y_BUILD/05/t421.out                                     |    88 +
 fias_loader/TESTS/Y_BUILD/05/t431.err                                     |     0
 fias_loader/TESTS/Y_BUILD/05/t431.out                                     |   214 +++
 fias_loader/TESTS/Y_BUILD/05/t441.err                                     |     0
 fias_loader/TESTS/Y_BUILD/05/t441.out                                     |   379 +++++
 fias_loader/TESTS/Y_BUILD/05/t451.err                                     |     0
 fias_loader/TESTS/Y_BUILD/05/t451.out                                     |   864 ++++++++++
 fias_loader/TESTS/Y_BUILD/05/t461.err                                     |     0
 fias_loader/TESTS/Y_BUILD/05/t461.out                                     |  1582 +++++++++++++++++
 fias_loader/TESTS/Y_BUILD/50/stage_4.1.sql                                |    20 +
 fias_loader/TESTS/Y_BUILD/50/stage_4.2.sql                                |    20 +
 fias_loader/TESTS/Y_BUILD/50/stage_4.3.sql                                |    20 +
 fias_loader/TESTS/Y_BUILD/50/stage_4.4.sql                                |    20 +
 fias_loader/TESTS/Y_BUILD/50/stage_4.5.sql                                |    24 +
 fias_loader/TESTS/Y_BUILD/50/stage_4.6.sql                                |    22 +
 fias_loader/TESTS/Y_BUILD/50/t41.err                                      |     0
 fias_loader/TESTS/Y_BUILD/50/t41.out                                      |    51 +
 fias_loader/TESTS/Y_BUILD/50/t42.err                                      |     0
 fias_loader/TESTS/Y_BUILD/50/t42.out                                      |    56 +
 fias_loader/TESTS/Y_BUILD/50/t43.err                                      |     0
 fias_loader/TESTS/Y_BUILD/50/t43.out                                      |   238 +++
 fias_loader/TESTS/Y_BUILD/50/t44.err                                      |     0
 fias_loader/TESTS/Y_BUILD/50/t44.out                                      |   253 +++
 fias_loader/TESTS/Y_BUILD/50/t45.err                                      |     0
 fias_loader/TESTS/Y_BUILD/50/t45.out                                      |  1814 ++++++++++++++++++++
 fias_loader/TESTS/Y_BUILD/50/t46.err                                      |     0
 fias_loader/TESTS/Y_BUILD/50/t46.out                                      | 11758 +++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
 fias_loader/TESTS/remarks.txt                                             |   162 +-
 58 files changed, 19441 insertions(+), 779 deletions(-)
------------------------------------------------------------------------
$>git status
# On branch master
# Your branch is ahead of 'origin/master' by 34 commits.  ????
#   (use "git push" to publish your local commits)
#
nothing to commit, working directory clean
$>

Посмотреть log и сравнить !!!

Пройдено:
      -- gar_fias_pcg_load.f_addr_obj_get_twins()    -- Утилита
      -- gar_fias_pcg_load.f_addr_obj_get_parents()  -- Обеспечивает её работу.
      
-- ============================================================================

 1) Выбрать ВСЕ записи, относящиеся к рассматриваемому региону.
 Они сгруппированы, ID группы это максимальное значение это максимальное значение
 change_id
 
    ,max (aa1.change_id) 
                       OVER (PARTITION BY aa1.id_addr_parent  
                                         ,aa1.addr_obj_type_id  
                                         ,UPPER(aa1.nm_addr_obj) 
                    ) AS id_lead
                    
 Допустим этого

2) Выбрать записи принадлежащие рассматриваемой группе
     Старшей записи передать всех подчинённых.
     Подчинённые дективировать (как, ,.....date_end)    
     
2023-10-30   
----------
           -- Активные предшественники, ревизия кода и оптимизация,
              (планы запросов, логика), место для запоминания "старого" uuid.
              
           -- Структура для хранения старого uuid --  ???
           
           -- Населённые пункты и т.д   и   т.п,  имеющие уровень 8.
              Элементы дорожно-планировочной структуры, они должны перейти на уровень выше.
             
           -- Почему не загрузились улицы             
              
2023-10-31   Обновление функционала. загрузки.
----------

2023-11-01  Собираю загрузочный пакет. + процедура управляющая индексами в схеме GAR_FIAS.
----------  
              Тестирование на: 

              unsi_test_23  --+ 
              unsi_test_50
              
2023-11-08      Что делаем ?
----------
       -+       Дополняю массив "fias_ids"  недостающими кодами.
                Они берутся из соответствующих таблиц базы 05, 23, 50.
            
       -+       Меняется запрос, формирующий данные для структуры "gar_tmp.xxx_adr_area"
                Для выбранного набора типов либо выполняется понижение уровня    --> 6
                либо 7 --> 8 (смотри базу № 5).
                
       -+       Проверить функции для "xxx_obj_fias".
       
       -+       Оформить patch (в нём создание twin-таблиц) и обновление массивов "fias_ids".
       
       --?      Перенести все изменения в ветку master. Руками, gar_fias_load, gar_tmp_trans
                собрать уже в master.
                
       -+       Проверить управление индексами в gar_fias.
       
       -+       Генератор parsing-scripts, включитьв текст создаваемого скрипта
                вызов функции, удаляющей индексы в gar_fias.
                
       -+       Py-сценарии для этапа 3  
       
       -+       Дополнительные скрипты для этапа 4
       
---------------------------------------------------------------------------------------------
2023-11-10

$>git push origin FilterObj
Username for 'https://github.com': nick-ch58@yandex.ru
Password for 'https://nick-ch58@yandex.ru@github.com': 
Подсчет объектов: 101, готово.
Delta compression using up to 4 threads.
Сжатие объектов: 100% (101/101), готово.
Запись объектов: 100% (101/101), 10.48 MiB | 584.00 KiB/s, готово.
Total 101 (delta 68), reused 0 (delta 0)
remote: Resolving deltas: 100% (68/68), completed with 37 local objects.
remote: warning: See https://gh.io/lfs for more information.
remote: warning: File fias_loader/TESTS/Y_BUILD/23/_OLD_process.out is 58.63 MB; this is larger than GitHub's recommended maximum file size of 50.00 MB
remote: warning: GH001: Large files detected. You may want to try Git Large File Storage - https://git-lfs.github.com.
To https://github.com/NickChadaev/pg_tools/
   bbf602f..1332c31  FilterObj -> FilterObj

   
   
   2023-11-13
   ----------   
                  -- Ревизия py-кода + сокращение атрибутного состава YAML-3
                  
-- --------------------------------------------------------------------------------------
--     Для обсуждения.
-- --------------------------------------------------------------------------------------

$>python stage_3_yaml.py  ../Yamls/_Small_cluster stage_31r.yaml 3, \('unnsi', 'unnsi', 'unnsi', 'gar_tmp'\), 6, '2023-12-12' 

** Control **

True
True
True
True
False
True
True
True
True
True
True
True

**  Global **

1
13
unnsi
unnsi
unnsi
gar_tmp
gar_tmp
gar_tmp
gar_tmp

** stage_3_I **

Создание рабочих индексов в схеме gar_fias. False-удаление, True-удаление,создание.
False
True

** stage_3_9 **

Заполнение таблицы с активными предшественниками
False
DATE(current_date)
16
1
True
Обработка таблицы с активными предшественниками, переподчинение и деактивация
False
DATE(current_date)
Повторное/Контрольное отображение дубликатов
False
DATE(current_date)
16
1

** stage_3_0 **

Установка признака LOGGED/UNLOGGED у таблиц в схеме gar_tmp
False
True
Очистка данных во временной схеме.
False
[1, 2, 7]
Смена индексного покрытия в отдалённых таблицах
True
True
True
True
True

** stage_3_1 **

Загрузка данных из таблицы ADR_AREA_TYPE
False
Загрузка данных из таблицы ADR_STREET_TYPE
False
Загрузка данных из таблицы ADR_HOUSE_TYPE
False
Загрузка регионального фрагмента из таблицы ADR_AREA
False
Загрузка регионального фрагмента из таблицы ADR_STREET
False
Загрузка регионального фрагмента из таблицы ADR_HOUSE
False
True
Установка последовательностей
False
gar_tmp.obj_seq
gar_tmp.obj_hist_seq
100000000
gar_tmp
gar_tmp
gar_tmp

** stage_3_2 **

Актуализация справочников (промежуточные XXX структуры)
[]
[1]
Промежуточный справочник типов адресных пространств
True
[]
UPDATE gar_tmp.xxx_adr_area_type SET fias_ids = fias_ids || 340::bigint WHERE (id_area_type = 51);
SELECT * FROM gar_tmp.xxx_adr_area_type ORDER BY 2;
Промежуточный справочник типов улиц
True
[]
None
SELECT * FROM gar_tmp.xxx_adr_street_type ORDER BY 2;
Промежуточный справочник типов домовладений
True
[]
None
SELECT * FROM gar_tmp.xxx_adr_house_type ORDER BY 2;

** stage_3_3 **
Агрегация данных
False
Агрегация параметров
[5, 6, 7, 8, 10, 11]
False
Агрегация адресных пространств
DATE(current_date)
10
None
False
Агрегация домовладений
DATE(current_date)
None
False
True
True
True
Заполнение управляющей таблицы "gar_tmp.xxx_obj_fias"
$>
-- --------------------------------------------------------------------------------------

2023-11-13  Перед накатом пакетов делать накат патча.

На большо хосте -- работает ветка FilterObj

$>git pull origin FilterObj
remote: Enumerating objects: 421, done.
remote: Counting objects: 100% (121/121), done.
remote: Compressing objects: 100% (6/6), done.
remote: Total 421 (delta 116), reused 115 (delta 115), pack-reused 300
Receiving objects: 100% (421/421), 13.23 MiB | 9.15 MiB/s, done.
Resolving deltas: 100% (285/285), completed with 47 local objects.
From https://github.com/NickChadaev/pg_tools
 * branch            FilterObj  -> FETCH_HEAD
Updating 98e129b..b91c4bb
Fast-forward
 fias_loader/DBMS/GAR_FIAS/createTablesGarFias_1.sql                             |     27 +
 fias_loader/DBMS/GAR_FIAS_PCG_LOAD/FUNCTION/_NEW_f_addr_obj_update_children.sql |    159 +
 fias_loader/DBMS/GAR_FIAS_PCG_LOAD/FUNCTION/_NEW_f_addr_obj_update_parent.sql   |     63 +
 fias_loader/DBMS/GAR_FIAS_PCG_LOAD/FUNCTION/_NEW_f_adr_area_set_data.sql        |    115 +
 fias_loader/DBMS/GAR_FIAS_PCG_LOAD/FUNCTION/_NEW_f_adr_area_show_data.sql       |    389 +
 fias_loader/DBMS/GAR_FIAS_PCG_LOAD/FUNCTION/f_addr_area_get_twins.sql           |     49 +
 fias_loader/DBMS/GAR_FIAS_PCG_LOAD/FUNCTION/f_addr_area_set_data.sql            |    116 +
 fias_loader/DBMS/GAR_FIAS_PCG_LOAD/FUNCTION/f_addr_area_show_data.sql           |    391 +
 fias_loader/DBMS/GAR_FIAS_PCG_LOAD/FUNCTION/f_addr_obj_agg.sql                  |     65 +
 fias_loader/DBMS/GAR_FIAS_PCG_LOAD/FUNCTION/f_addr_obj_get_parents.sql          |    250 +-
 fias_loader/DBMS/GAR_FIAS_PCG_LOAD/FUNCTION/f_addr_obj_update_children.sql      |    205 +-
 fias_loader/DBMS/GAR_FIAS_PCG_LOAD/FUNCTION/f_addr_obj_update_parent.sql        |     50 +-
 fias_loader/DBMS/GAR_FIAS_PCG_LOAD/FUNCTION/f_adr_area_get_twins.sql            |     30 +-
 fias_loader/DBMS/GAR_FIAS_PCG_LOAD/FUNCTION/f_adr_area_set_data.sql             |    109 +-
 fias_loader/DBMS/GAR_FIAS_PCG_LOAD/FUNCTION/f_adr_area_show_data.sql            |    335 +-
 fias_loader/DBMS/GAR_FIAS_PCG_LOAD/PROCEDURE/p_twin_addr_objects_put.sql        |     54 +
 fias_loader/DBMS/GAR_FIAS_PCG_LOAD/gar_fias_pcg_load.err                        |     83 +-
 fias_loader/DBMS/GAR_FIAS_PCG_LOAD/gar_fias_pcg_load.err.bak                    |    112 +-
 fias_loader/DBMS/GAR_FIAS_PCG_LOAD/gar_fias_pcg_load.log                        |     84 +-
 fias_loader/DBMS/GAR_FIAS_PCG_LOAD/gar_fias_pcg_load.log.bak                    |     84 +-
 fias_loader/DBMS/GAR_FIAS_PCG_LOAD/gar_fias_pcg_load.sql                        |   1109 +-
 fias_loader/DBMS/GAR_FIAS_PCG_LOAD/gar_fias_pcg_load.sql.bak                    |   1099 +-
 fias_loader/DBMS/GAR_FIAS_PCG_LOAD/stage_25_gar_build.csv                       |     11 +-
 fias_loader/DBMS/GAR_FIAS_PCG_LOAD/version.sql                                  |      2 +-
 fias_loader/DBMS/GAR_TMP_PCG_TRANS/DO/adr_area_post_proc_90.sql                 |     14 +
 fias_loader/DBMS/GAR_TMP_PCG_TRANS/DO/adr_house_post_proc_90.sql                |     13 +
 fias_loader/DBMS/GAR_TMP_PCG_TRANS/DO/adr_street_post_proc_90.sql               |     13 +
 fias_loader/DBMS/GAR_TMP_PCG_TRANS/FUNCTION/f_adr_area_get.sql                  |     29 +-
 fias_loader/DBMS/GAR_TMP_PCG_TRANS/FUNCTION/f_adr_area_ins.sql                  |     27 +-
 fias_loader/DBMS/GAR_TMP_PCG_TRANS/FUNCTION/f_adr_area_upd.sql                  |     27 +-
 fias_loader/DBMS/GAR_TMP_PCG_TRANS/FUNCTION/f_adr_house_get.sql                 |     34 +-
 fias_loader/DBMS/GAR_TMP_PCG_TRANS/FUNCTION/f_adr_house_ins.sql                 |     28 +-
 fias_loader/DBMS/GAR_TMP_PCG_TRANS/FUNCTION/f_adr_house_upd.sql                 |     25 +-
 fias_loader/DBMS/GAR_TMP_PCG_TRANS/FUNCTION/f_adr_street_get.sql                |     25 +-
 fias_loader/DBMS/GAR_TMP_PCG_TRANS/FUNCTION/f_adr_street_ins.sql                |     27 +-
 fias_loader/DBMS/GAR_TMP_PCG_TRANS/FUNCTION/f_adr_street_upd.sql                |     27 +-
 fias_loader/DBMS/GAR_TMP_PCG_TRANS/FUNCTION/f_xxx_adr_area_show_data.sql        |     90 +-
 fias_loader/DBMS/GAR_TMP_PCG_TRANS/FUNCTION/f_xxx_adr_object_get_level.sql      |     52 +
 fias_loader/DBMS/GAR_TMP_PCG_TRANS/FUNCTION/f_xxx_obj_fias_0.sql                |      7 +-
 fias_loader/DBMS/GAR_TMP_PCG_TRANS/FUNCTION/f_xxx_obj_fias_1.sql                |      5 +-
 fias_loader/DBMS/GAR_TMP_PCG_TRANS/FUNCTION/fp_adr_house_upd.sql                |     28 +-
 fias_loader/DBMS/GAR_TMP_PCG_TRANS/PROCEDURE/p_adr_area_ins.sql                 |     56 +-
 fias_loader/DBMS/GAR_TMP_PCG_TRANS/PROCEDURE/p_adr_area_upd.sql                 |     34 +-
 fias_loader/DBMS/GAR_TMP_PCG_TRANS/PROCEDURE/p_adr_house_ins.sql                |     10 +
 fias_loader/DBMS/GAR_TMP_PCG_TRANS/PROCEDURE/p_adr_street_ins.sql               |     17 +-
 fias_loader/DBMS/GAR_TMP_PCG_TRANS/PROCEDURE/p_adr_street_upd.sql               |     37 +-
 fias_loader/DBMS/GAR_TMP_PCG_TRANS/PROCEDURE/p_gar_fias_crt_idx.sql             |     21 +-
 fias_loader/DBMS/GAR_TMP_PCG_TRANS/gar_tmp_trans_pcg.err                        |    432 +-
 fias_loader/DBMS/GAR_TMP_PCG_TRANS/gar_tmp_trans_pcg.err.bak                    |    407 +-
 fias_loader/DBMS/GAR_TMP_PCG_TRANS/gar_tmp_trans_pcg.log                        |    175 +-
 fias_loader/DBMS/GAR_TMP_PCG_TRANS/gar_tmp_trans_pcg.log.bak                    |    175 +-
 fias_loader/DBMS/GAR_TMP_PCG_TRANS/gar_tmp_trans_pcg.sql                        |    610 +-
 fias_loader/DBMS/GAR_TMP_PCG_TRANS/gar_tmp_trans_pcg.sql.bak                    |    597 +-
 fias_loader/DBMS/GAR_TMP_PCG_TRANS/stage_25_tmp_build.csv                       |      5 +-
 fias_loader/DBMS/GAR_TMP_PCG_TRANS/version.sql                                  |      2 +-
 fias_loader/DBMS/process.log                                                    |     48 +
 fias_loader/DBMS/process.out                                                    |   1285 +
 fias_loader/DBMS/process.sql                                                    |      2 +
 fias_loader/DBMS/xxx_all_types_build_patch_20231108.csv                         |     28 +
 fias_loader/DBMS/xxx_all_types_build_patch_20231108.sql                         |     66 +
 fias_loader/TESTS/G31_work_tbl_check.sql                                        |    206 +
 fias_loader/TESTS/G3_crt_view.sql                                               |     11 +-
 fias_loader/TESTS/G3_work_tbl_check.sql                                         |    191 +-
 fias_loader/TESTS/Y_BUILD/01/_TEST_street_get_parents.sql                       |    154 +
 fias_loader/TESTS/Y_BUILD/01/process.err                                        |      2 +
 fias_loader/TESTS/Y_BUILD/01/process.log                                        |     64 +
 fias_loader/TESTS/Y_BUILD/01/process.out                                        |    800 +
 fias_loader/TESTS/Y_BUILD/01/process.sql                                        |      6 +
 fias_loader/TESTS/Y_BUILD/01/stage_31_01.csv                                    |     16 +
 fias_loader/TESTS/Y_BUILD/01/stage_3_01.csv                                     |     23 +
 fias_loader/TESTS/Y_BUILD/01/stage_4.1.sql                                      |     22 +
 fias_loader/TESTS/Y_BUILD/01/stage_4.2.sql                                      |     21 +
 fias_loader/TESTS/Y_BUILD/01/stage_4.3.sql                                      |     21 +
 fias_loader/TESTS/Y_BUILD/01/stage_4.4.sql                                      |     21 +
 fias_loader/TESTS/Y_BUILD/01/stage_4.5.sql                                      |     23 +
 fias_loader/TESTS/Y_BUILD/01/stage_4.6.sql                                      |     22 +
 fias_loader/TESTS/Y_BUILD/01/stage_gar_c_01.csv                                 |     11 +-
 fias_loader/TESTS/Y_BUILD/05/.~lock._TEST_area_get_parents.xlsx#                |      1 +
 fias_loader/TESTS/Y_BUILD/05/.~lock._TEST_house_get_parents.csv#                |      1 +
 fias_loader/TESTS/Y_BUILD/05/.~lock._TEST_street_get_parents.csv#               |      1 +
 fias_loader/TESTS/Y_BUILD/05/.~lock._TEST_update_level_0.xlsx#                  |      1 +
 fias_loader/TESTS/Y_BUILD/05/.~lock._TEST_update_level_1.xlsx#                  |      1 +
 fias_loader/TESTS/Y_BUILD/05/_TEST_area_get_parents.csv                         |    256 +
 fias_loader/TESTS/Y_BUILD/05/_TEST_area_get_parents.sql                         |      7 +
 fias_loader/TESTS/Y_BUILD/05/_TEST_area_get_parents.xlsx                        |    Bin 0 -> 19509 bytes
 fias_loader/TESTS/Y_BUILD/05/_TEST_as_adr_obj_type.csv                          |    356 +
 fias_loader/TESTS/Y_BUILD/05/_TEST_as_adr_obj_type.sql                          |    118 +
 fias_loader/TESTS/Y_BUILD/05/_TEST_house_get_parents.csv                        |   7902 ++++++
 fias_loader/TESTS/Y_BUILD/05/_TEST_street_get_parents.csv                       |   1055 +
 fias_loader/TESTS/Y_BUILD/05/_TEST_street_get_parents.sql                       |    117 +
 fias_loader/TESTS/Y_BUILD/05/_TEST_street_get_parents_1.sql                     |    604 +
 fias_loader/TESTS/Y_BUILD/05/_TEST_update_children_0.sql                        |     51 +
 fias_loader/TESTS/Y_BUILD/05/_TEST_update_children_1.sql                        |     77 +
 fias_loader/TESTS/Y_BUILD/05/_TEST_update_level_0.csv                           |     18 +
 fias_loader/TESTS/Y_BUILD/05/_TEST_update_level_0.sql                           |     43 +
 fias_loader/TESTS/Y_BUILD/05/_TEST_update_level_0.xlsx                          |    Bin 0 -> 53684 bytes
 fias_loader/TESTS/Y_BUILD/05/_TEST_update_level_1.csv                           |   1113 +
 fias_loader/TESTS/Y_BUILD/05/_TEST_update_level_1.xlsx                          |    Bin 0 -> 125175 bytes
 fias_loader/TESTS/Y_BUILD/05/_TEST_update_level_2.csv                           |    314 +
 fias_loader/TESTS/Y_BUILD/05/_TEST_xxx_adr_area_type.csv                        |     91 +
 fias_loader/TESTS/Y_BUILD/05/_TEST_xxx_adr_street_type.csv                      |     47 +
 fias_loader/TESTS/Y_BUILD/05/p6_process_20231024_161608.err                     |      0
 fias_loader/TESTS/Y_BUILD/05/p6_process_20231024_161608.log                     |     40 +
 fias_loader/TESTS/Y_BUILD/05/p6_process_20231024_161608.out                     |     41 +
 fias_loader/TESTS/Y_BUILD/05/p6_process_20231024_161608.sql                     |      2 +
 fias_loader/TESTS/Y_BUILD/05/patch_20231128.sql                                 |     82 +
 fias_loader/TESTS/Y_BUILD/05/plan_f_addr_area_show_data_05.csv                  |     88 +
 fias_loader/TESTS/Y_BUILD/05/plan_f_addr_area_show_data_05.xlsx                 |    Bin 0 -> 7837 bytes
 fias_loader/TESTS/Y_BUILD/05/plan_f_addr_area_show_data_05_1.xlsx               |    Bin 0 -> 6001 bytes
 fias_loader/TESTS/Y_BUILD/05/process.err                                        |     30 +
 fias_loader/TESTS/Y_BUILD/05/process.log                                        |     93 +
 fias_loader/TESTS/Y_BUILD/05/process.out                                        |  10491 +++++++
 fias_loader/TESTS/Y_BUILD/05/process.sql                                        |     10 +
 fias_loader/TESTS/Y_BUILD/05/r0_process_20231024_203503.err                     |    135 +
 fias_loader/TESTS/Y_BUILD/05/r0_process_20231024_203503.log                     |     39 +
 fias_loader/TESTS/Y_BUILD/05/r0_process_20231024_203503.out                     |    701 +
 fias_loader/TESTS/Y_BUILD/05/r0_process_20231024_203503.sql                     |      2 +
 fias_loader/TESTS/Y_BUILD/05/stage_31_05.csv                                    |     20 +
 fias_loader/TESTS/Y_BUILD/05/stage_3_01.csv                                     |     23 +
 fias_loader/TESTS/Y_BUILD/05/stage_3_05.csv                                     |     23 +
 fias_loader/TESTS/Y_BUILD/05/stage_4.1.sql                                      |     39 +-
 fias_loader/TESTS/Y_BUILD/05/stage_4.2.sql                                      |     12 +-
 fias_loader/TESTS/Y_BUILD/05/stage_4.3.sql                                      |      5 +-
 fias_loader/TESTS/Y_BUILD/05/stage_4.4.sql                                      |     11 +-
 fias_loader/TESTS/Y_BUILD/05/stage_4.5.sql                                      |      7 +-
 fias_loader/TESTS/Y_BUILD/05/stage_4.6.sql                                      |      6 +-
 fias_loader/TESTS/Y_BUILD/05/stage_gar_c_01.csv                                 |     13 +
 fias_loader/TESTS/Y_BUILD/05/stage_gar_c_05.csv                                 |     11 +-
 fias_loader/TESTS/Y_BUILD/05/t41.out                                            |    427 +-
 fias_loader/TESTS/Y_BUILD/05/t42.out                                            |    115 +-
 fias_loader/TESTS/Y_BUILD/05/t43.out                                            |    975 +-
 fias_loader/TESTS/Y_BUILD/05/t44.out                                            |    226 +-
 fias_loader/TESTS/Y_BUILD/05/twins_05.csv                                       |      4 +
 fias_loader/TESTS/Y_BUILD/05/twins_05_1.csv                                     |      8 +
 fias_loader/TESTS/Y_BUILD/05/twins_05_2.csv                                     |      8 +
 fias_loader/TESTS/Y_BUILD/23/_OLD_process.err                                   |     27 +
 fias_loader/TESTS/Y_BUILD/23/_OLD_process.out                                   | 183870 ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
 fias_loader/TESTS/Y_BUILD/23/_TEST_23.csv                                       |     36 +
 fias_loader/TESTS/Y_BUILD/23/_TEST_23.xlsx                                      |    Bin 0 -> 11386 bytes
 fias_loader/TESTS/Y_BUILD/23/_TEST_street_get_parent_1.sql                      |     34 +
 fias_loader/TESTS/Y_BUILD/23/_TEST_street_get_parents.sql                       |    220 +
 fias_loader/TESTS/Y_BUILD/23/gar_tmp.adr_area_type.sql                          |    249 +
 fias_loader/TESTS/Y_BUILD/23/gar_tmp.adr_house_type.sql                         |    117 +
 fias_loader/TESTS/Y_BUILD/23/gar_tmp.adr_street_type.sql                        |    155 +
 fias_loader/TESTS/Y_BUILD/23/gar_tmp.xxx_object_type_alias.sql                  |     85 +
 fias_loader/TESTS/Y_BUILD/23/process.err                                        |      3 +
 fias_loader/TESTS/Y_BUILD/23/process.log                                        |     93 +
 fias_loader/TESTS/Y_BUILD/23/process.out                                        |     63 +
 fias_loader/TESTS/Y_BUILD/23/process.sql                                        |     10 +
 fias_loader/TESTS/Y_BUILD/23/stage_31_01.csv                                    |     16 +
 fias_loader/TESTS/Y_BUILD/23/stage_31_23.csv                                    |     20 +
 fias_loader/TESTS/Y_BUILD/23/stage_3_01.csv                                     |     23 +
 fias_loader/TESTS/Y_BUILD/23/stage_3_23.csv                                     |     23 +
 fias_loader/TESTS/Y_BUILD/23/stage_4.1.sql                                      |     22 +
 fias_loader/TESTS/Y_BUILD/23/stage_4.2.sql                                      |     21 +
 fias_loader/TESTS/Y_BUILD/23/stage_4.3.sql                                      |     21 +
 fias_loader/TESTS/Y_BUILD/23/stage_4.4.sql                                      |     21 +
 fias_loader/TESTS/Y_BUILD/23/stage_4.5.sql                                      |     23 +
 fias_loader/TESTS/Y_BUILD/23/stage_4.6.sql                                      |     22 +
 fias_loader/TESTS/Y_BUILD/23/stage_gar_c_01.csv                                 |     13 +
 fias_loader/TESTS/Y_BUILD/50/.~lock._TEST_50.csv#                               |      1 +
 fias_loader/TESTS/Y_BUILD/50/_OLD_process.out                                   |  30103 ++++++++++++++++++++
 fias_loader/TESTS/Y_BUILD/50/_TEST_50.csv                                       |    179 +
 fias_loader/TESTS/Y_BUILD/50/_TEST_street_get_parents.sql                       |    885 +
 fias_loader/TESTS/Y_BUILD/50/patch_20231128.sql                                 |    101 +
 fias_loader/TESTS/Y_BUILD/50/process.err                                        |     35 +
 fias_loader/TESTS/Y_BUILD/50/process.log                                        |     93 +
 fias_loader/TESTS/Y_BUILD/50/process.out                                        |  11100 ++++++++
 fias_loader/TESTS/Y_BUILD/50/process.sql                                        |     10 +
 fias_loader/TESTS/Y_BUILD/50/stage_31_23.csv                                    |     20 +
 fias_loader/TESTS/Y_BUILD/50/stage_31_50.csv                                    |     20 +
 fias_loader/TESTS/Y_BUILD/50/stage_3_23.csv                                     |     23 +
 fias_loader/TESTS/Y_BUILD/50/stage_3_50.csv                                     |     23 +
 fias_loader/TESTS/Y_BUILD/50/stage_4.1.sql                                      |     22 +
 fias_loader/TESTS/Y_BUILD/50/stage_4.2.sql                                      |     21 +
 fias_loader/TESTS/Y_BUILD/50/stage_4.3.sql                                      |     21 +
 fias_loader/TESTS/Y_BUILD/50/stage_4.4.sql                                      |     21 +
 fias_loader/TESTS/Y_BUILD/50/stage_4.5.sql                                      |     23 +
 fias_loader/TESTS/Y_BUILD/50/stage_4.6.sql                                      |     22 +
 fias_loader/TESTS/Y_BUILD/50/stage_gar_c_50.csv                                 |     13 +
 fias_loader/TESTS/remarks.txt                                                   |    494 +-
 
 load_main/GarProcess/__init__.pyc                                               |    Bin 0 -> 152 bytes
 load_main/GarProcess/stage_3_proc.py                                            |     24 +-
 load_main/GarProcess/stage_3_proc.pyc                                           |    Bin 0 -> 10403 bytes
 load_main/GarProcess/stage_3_yaml.py                                            |     53 +-
 load_main/GarProcess/stage_3_yaml.pyc                                           |    Bin 0 -> 11854 bytes
 load_main/MainProcess/__init__.pyc                                              |    Bin 0 -> 153 bytes
 load_main/MainProcess/fd_0.pyc                                                  |    Bin 0 -> 3063 bytes
 load_main/MainProcess/fd_log.pyc                                                |    Bin 0 -> 4598 bytes
 load_main/Yamls/_Big_cluster/stage_31r.yaml                                     |     21 +-
 load_main/Yamls/_Big_cluster/stage_41r.yaml                                     |     14 +-
 load_main/Yamls/_Small_cluster/stage_31r.yaml                                   |     31 +-
 load_main/Yamls/_Small_cluster/stage_41r.yaml                                   |     12 +-
 load_main/load_mainCrtScripts.py                                                |      5 +-
 load_main/load_mainStage3.py                                                    |     20 +-
 load_main/process.err                                                           |    104 +
 load_main/process.log                                                           |     22 +
 
 197 files changed, 261678 insertions(+), 3989 deletions(-)
 create mode 100644 fias_loader/DBMS/GAR_FIAS/createTablesGarFias_1.sql
 create mode 100644 fias_loader/DBMS/GAR_FIAS_PCG_LOAD/FUNCTION/_NEW_f_addr_obj_update_children.sql
 create mode 100644 fias_loader/DBMS/GAR_FIAS_PCG_LOAD/FUNCTION/_NEW_f_addr_obj_update_parent.sql
 create mode 100644 fias_loader/DBMS/GAR_FIAS_PCG_LOAD/FUNCTION/_NEW_f_adr_area_set_data.sql
 create mode 100644 fias_loader/DBMS/GAR_FIAS_PCG_LOAD/FUNCTION/_NEW_f_adr_area_show_data.sql
 create mode 100644 fias_loader/DBMS/GAR_FIAS_PCG_LOAD/FUNCTION/f_addr_area_get_twins.sql
 create mode 100644 fias_loader/DBMS/GAR_FIAS_PCG_LOAD/FUNCTION/f_addr_area_set_data.sql
 create mode 100644 fias_loader/DBMS/GAR_FIAS_PCG_LOAD/FUNCTION/f_addr_area_show_data.sql
 create mode 100644 fias_loader/DBMS/GAR_FIAS_PCG_LOAD/FUNCTION/f_addr_obj_agg.sql
 create mode 100644 fias_loader/DBMS/GAR_FIAS_PCG_LOAD/PROCEDURE/p_twin_addr_objects_put.sql
 create mode 100644 fias_loader/DBMS/GAR_TMP_PCG_TRANS/DO/adr_area_post_proc_90.sql
 create mode 100644 fias_loader/DBMS/GAR_TMP_PCG_TRANS/DO/adr_house_post_proc_90.sql
 create mode 100644 fias_loader/DBMS/GAR_TMP_PCG_TRANS/DO/adr_street_post_proc_90.sql
 create mode 100644 fias_loader/DBMS/GAR_TMP_PCG_TRANS/FUNCTION/f_xxx_adr_object_get_level.sql
 create mode 100644 fias_loader/DBMS/process.log
 create mode 100644 fias_loader/DBMS/process.out
 create mode 100644 fias_loader/DBMS/process.sql
 create mode 100644 fias_loader/DBMS/xxx_all_types_build_patch_20231108.csv
 create mode 100644 fias_loader/DBMS/xxx_all_types_build_patch_20231108.sql
 create mode 100644 fias_loader/TESTS/G31_work_tbl_check.sql
 create mode 100644 fias_loader/TESTS/Y_BUILD/01/_TEST_street_get_parents.sql
 create mode 100644 fias_loader/TESTS/Y_BUILD/01/process.err
 create mode 100644 fias_loader/TESTS/Y_BUILD/01/process.log
 create mode 100644 fias_loader/TESTS/Y_BUILD/01/process.out
 create mode 100644 fias_loader/TESTS/Y_BUILD/01/process.sql
 create mode 100644 fias_loader/TESTS/Y_BUILD/01/stage_31_01.csv
 create mode 100644 fias_loader/TESTS/Y_BUILD/01/stage_3_01.csv
 create mode 100644 fias_loader/TESTS/Y_BUILD/01/stage_4.1.sql
 create mode 100644 fias_loader/TESTS/Y_BUILD/01/stage_4.2.sql
 create mode 100644 fias_loader/TESTS/Y_BUILD/01/stage_4.3.sql
 create mode 100644 fias_loader/TESTS/Y_BUILD/01/stage_4.4.sql
 create mode 100644 fias_loader/TESTS/Y_BUILD/01/stage_4.5.sql
 create mode 100644 fias_loader/TESTS/Y_BUILD/01/stage_4.6.sql
 create mode 100644 fias_loader/TESTS/Y_BUILD/05/.~lock._TEST_area_get_parents.xlsx#
 create mode 100644 fias_loader/TESTS/Y_BUILD/05/.~lock._TEST_house_get_parents.csv#
 create mode 100644 fias_loader/TESTS/Y_BUILD/05/.~lock._TEST_street_get_parents.csv#
 create mode 100644 fias_loader/TESTS/Y_BUILD/05/.~lock._TEST_update_level_0.xlsx#
 create mode 100644 fias_loader/TESTS/Y_BUILD/05/.~lock._TEST_update_level_1.xlsx#
 create mode 100644 fias_loader/TESTS/Y_BUILD/05/_TEST_area_get_parents.csv
 create mode 100644 fias_loader/TESTS/Y_BUILD/05/_TEST_area_get_parents.sql
 create mode 100644 fias_loader/TESTS/Y_BUILD/05/_TEST_area_get_parents.xlsx
 create mode 100644 fias_loader/TESTS/Y_BUILD/05/_TEST_as_adr_obj_type.csv
 create mode 100644 fias_loader/TESTS/Y_BUILD/05/_TEST_as_adr_obj_type.sql
 create mode 100644 fias_loader/TESTS/Y_BUILD/05/_TEST_house_get_parents.csv
 create mode 100644 fias_loader/TESTS/Y_BUILD/05/_TEST_street_get_parents.csv
 create mode 100644 fias_loader/TESTS/Y_BUILD/05/_TEST_street_get_parents.sql
 create mode 100644 fias_loader/TESTS/Y_BUILD/05/_TEST_street_get_parents_1.sql
 create mode 100644 fias_loader/TESTS/Y_BUILD/05/_TEST_update_children_0.sql
 create mode 100644 fias_loader/TESTS/Y_BUILD/05/_TEST_update_children_1.sql
 create mode 100644 fias_loader/TESTS/Y_BUILD/05/_TEST_update_level_0.csv
 create mode 100644 fias_loader/TESTS/Y_BUILD/05/_TEST_update_level_0.sql
 create mode 100644 fias_loader/TESTS/Y_BUILD/05/_TEST_update_level_0.xlsx
 create mode 100644 fias_loader/TESTS/Y_BUILD/05/_TEST_update_level_1.csv
 create mode 100644 fias_loader/TESTS/Y_BUILD/05/_TEST_update_level_1.xlsx
 create mode 100644 fias_loader/TESTS/Y_BUILD/05/_TEST_update_level_2.csv
 create mode 100644 fias_loader/TESTS/Y_BUILD/05/_TEST_xxx_adr_area_type.csv
 create mode 100644 fias_loader/TESTS/Y_BUILD/05/_TEST_xxx_adr_street_type.csv
 create mode 100644 fias_loader/TESTS/Y_BUILD/05/p6_process_20231024_161608.err
 create mode 100644 fias_loader/TESTS/Y_BUILD/05/p6_process_20231024_161608.log
 create mode 100644 fias_loader/TESTS/Y_BUILD/05/p6_process_20231024_161608.out
 create mode 100644 fias_loader/TESTS/Y_BUILD/05/p6_process_20231024_161608.sql
 create mode 100644 fias_loader/TESTS/Y_BUILD/05/patch_20231128.sql
 create mode 100644 fias_loader/TESTS/Y_BUILD/05/plan_f_addr_area_show_data_05.csv
 create mode 100644 fias_loader/TESTS/Y_BUILD/05/plan_f_addr_area_show_data_05.xlsx
 create mode 100644 fias_loader/TESTS/Y_BUILD/05/plan_f_addr_area_show_data_05_1.xlsx
 create mode 100644 fias_loader/TESTS/Y_BUILD/05/process.err
 create mode 100644 fias_loader/TESTS/Y_BUILD/05/process.log
 create mode 100644 fias_loader/TESTS/Y_BUILD/05/process.out
 create mode 100644 fias_loader/TESTS/Y_BUILD/05/process.sql
 create mode 100644 fias_loader/TESTS/Y_BUILD/05/r0_process_20231024_203503.err
 create mode 100644 fias_loader/TESTS/Y_BUILD/05/r0_process_20231024_203503.log
 create mode 100644 fias_loader/TESTS/Y_BUILD/05/r0_process_20231024_203503.out
 create mode 100644 fias_loader/TESTS/Y_BUILD/05/r0_process_20231024_203503.sql
 create mode 100644 fias_loader/TESTS/Y_BUILD/05/stage_31_05.csv
 create mode 100644 fias_loader/TESTS/Y_BUILD/05/stage_3_01.csv
 create mode 100644 fias_loader/TESTS/Y_BUILD/05/stage_3_05.csv
 create mode 100755 fias_loader/TESTS/Y_BUILD/05/stage_gar_c_01.csv
 create mode 100644 fias_loader/TESTS/Y_BUILD/05/twins_05.csv
 create mode 100644 fias_loader/TESTS/Y_BUILD/05/twins_05_1.csv
 create mode 100644 fias_loader/TESTS/Y_BUILD/05/twins_05_2.csv
 create mode 100644 fias_loader/TESTS/Y_BUILD/23/_OLD_process.err
 create mode 100644 fias_loader/TESTS/Y_BUILD/23/_OLD_process.out
 create mode 100644 fias_loader/TESTS/Y_BUILD/23/_TEST_23.csv
 create mode 100644 fias_loader/TESTS/Y_BUILD/23/_TEST_23.xlsx
 create mode 100644 fias_loader/TESTS/Y_BUILD/23/_TEST_street_get_parent_1.sql
 create mode 100644 fias_loader/TESTS/Y_BUILD/23/_TEST_street_get_parents.sql
 create mode 100644 fias_loader/TESTS/Y_BUILD/23/gar_tmp.adr_area_type.sql
 create mode 100644 fias_loader/TESTS/Y_BUILD/23/gar_tmp.adr_house_type.sql
 create mode 100644 fias_loader/TESTS/Y_BUILD/23/gar_tmp.adr_street_type.sql
 create mode 100644 fias_loader/TESTS/Y_BUILD/23/gar_tmp.xxx_object_type_alias.sql
 create mode 100644 fias_loader/TESTS/Y_BUILD/23/process.err
 create mode 100644 fias_loader/TESTS/Y_BUILD/23/process.log
 create mode 100644 fias_loader/TESTS/Y_BUILD/23/process.out
 create mode 100644 fias_loader/TESTS/Y_BUILD/23/process.sql
 create mode 100644 fias_loader/TESTS/Y_BUILD/23/stage_31_01.csv
 create mode 100644 fias_loader/TESTS/Y_BUILD/23/stage_31_23.csv
 create mode 100644 fias_loader/TESTS/Y_BUILD/23/stage_3_01.csv
 create mode 100644 fias_loader/TESTS/Y_BUILD/23/stage_3_23.csv
 create mode 100644 fias_loader/TESTS/Y_BUILD/23/stage_4.1.sql
 create mode 100644 fias_loader/TESTS/Y_BUILD/23/stage_4.2.sql
 create mode 100644 fias_loader/TESTS/Y_BUILD/23/stage_4.3.sql
 create mode 100644 fias_loader/TESTS/Y_BUILD/23/stage_4.4.sql
 create mode 100644 fias_loader/TESTS/Y_BUILD/23/stage_4.5.sql
 create mode 100644 fias_loader/TESTS/Y_BUILD/23/stage_4.6.sql
 create mode 100755 fias_loader/TESTS/Y_BUILD/23/stage_gar_c_01.csv
 create mode 100644 fias_loader/TESTS/Y_BUILD/50/.~lock._TEST_50.csv#
 create mode 100644 fias_loader/TESTS/Y_BUILD/50/_OLD_process.out
 create mode 100644 fias_loader/TESTS/Y_BUILD/50/_TEST_50.csv
 create mode 100644 fias_loader/TESTS/Y_BUILD/50/_TEST_street_get_parents.sql
 create mode 100644 fias_loader/TESTS/Y_BUILD/50/patch_20231128.sql
 create mode 100644 fias_loader/TESTS/Y_BUILD/50/process.err
 create mode 100644 fias_loader/TESTS/Y_BUILD/50/process.log
 create mode 100644 fias_loader/TESTS/Y_BUILD/50/process.out
 create mode 100644 fias_loader/TESTS/Y_BUILD/50/process.sql
 create mode 100644 fias_loader/TESTS/Y_BUILD/50/stage_31_23.csv
 create mode 100644 fias_loader/TESTS/Y_BUILD/50/stage_31_50.csv
 create mode 100644 fias_loader/TESTS/Y_BUILD/50/stage_3_23.csv
 create mode 100644 fias_loader/TESTS/Y_BUILD/50/stage_3_50.csv
 create mode 100644 fias_loader/TESTS/Y_BUILD/50/stage_4.1.sql
 create mode 100644 fias_loader/TESTS/Y_BUILD/50/stage_4.2.sql
 create mode 100644 fias_loader/TESTS/Y_BUILD/50/stage_4.3.sql
 create mode 100644 fias_loader/TESTS/Y_BUILD/50/stage_4.4.sql
 create mode 100644 fias_loader/TESTS/Y_BUILD/50/stage_4.5.sql
 create mode 100644 fias_loader/TESTS/Y_BUILD/50/stage_4.6.sql
 create mode 100755 fias_loader/TESTS/Y_BUILD/50/stage_gar_c_50.csv
 
 create mode 100644 load_main/GarProcess/__init__.pyc
 create mode 100644 load_main/GarProcess/stage_3_proc.pyc
 create mode 100644 load_main/GarProcess/stage_3_yaml.pyc
 create mode 100644 load_main/MainProcess/__init__.pyc
 create mode 100644 load_main/MainProcess/fd_0.pyc
 create mode 100644 load_main/MainProcess/fd_log.pyc
 create mode 100644 load_main/process.err
 create mode 100644 load_main/process.log

 
GarProcess
            stage_3_yaml.py
            stage_3_proc.py

load_mainCrtScripts.py
load_mainStage3.py

2023-11-14        -- Сценарии для pg_perfect_ticker
----------      "  Version 1.0.1 Build 2023-11-14"

GarProcess
          stage_3_yaml.py  -+
          stage_3_proc.py  -+

load_mainStage3.py --
-----------------------------
$>python3 stage_3_yaml.py ../../../load_main/Yamls/_Big_cluster stage_31r.yaml
$>python3 stage_3_proc.py

$>python3 load_mainStage3.py
  Version 1.0.1 Build 2023-11-14
  Usage: load_mainStage3.py <Host_IP> <Port> <DB_name> <User_name> <YAML_file_name> <Path> <Id_region> <Date>
$>

$>git pull origin FilterObj
remote: Enumerating objects: 26, done.
remote: Counting objects: 100% (26/26), done.
remote: Compressing objects: 100% (8/8), done.
remote: Total 26 (delta 19), reused 25 (delta 18), pack-reused 0
Unpacking objects: 100% (26/26), done.
From https://github.com/NickChadaev/pg_tools
 * branch            FilterObj  -> FETCH_HEAD
Updating b91c4bb..64c57de
Fast-forward
 db_exchange/pg-perfect-ticker/GarProcess/stage_3_proc.py          |    24 +-
 db_exchange/pg-perfect-ticker/GarProcess/stage_3_yaml.py          |    58 +-
 db_exchange/pg-perfect-ticker/load_mainStage3.py                  |    20 +-
 fias_loader/TESTS/Y_BUILD/05/.~lock._TEST_area_get_parents.xlsx#  |     1 -
 fias_loader/TESTS/Y_BUILD/05/.~lock._TEST_house_get_parents.csv#  |     1 -
 fias_loader/TESTS/Y_BUILD/05/.~lock._TEST_street_get_parents.csv# |     1 -
 fias_loader/TESTS/Y_BUILD/05/.~lock._TEST_update_level_0.xlsx#    |     1 -
 fias_loader/TESTS/Y_BUILD/05/.~lock._TEST_update_level_1.xlsx#    |     1 -
 fias_loader/TESTS/Y_BUILD/05/_TEST_house_get_parents.csv          | 15804 +++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++--------------------------------------------------------------------
 fias_loader/TESTS/Y_BUILD/05/_TEST_update_level_1.xlsx            |   Bin 125175 -> 125179 bytes
 fias_loader/TESTS/Y_BUILD/50/.~lock._TEST_50.csv#                 |     1 -
 fias_loader/TESTS/remarks.txt                                     |   377 +++-
 12 files changed, 8341 insertions(+), 7948 deletions(-)
 delete mode 100644 fias_loader/TESTS/Y_BUILD/05/.~lock._TEST_area_get_parents.xlsx#
 delete mode 100644 fias_loader/TESTS/Y_BUILD/05/.~lock._TEST_house_get_parents.csv#
 delete mode 100644 fias_loader/TESTS/Y_BUILD/05/.~lock._TEST_street_get_parents.csv#
 delete mode 100644 fias_loader/TESTS/Y_BUILD/05/.~lock._TEST_update_level_0.xlsx#
 delete mode 100644 fias_loader/TESTS/Y_BUILD/05/.~lock._TEST_update_level_1.xlsx#
 delete mode 100644 fias_loader/TESTS/Y_BUILD/50/.~lock._TEST_50.csv#

 
 Ошибки:
 ------
  db_exchange/pg-perfect-ticker/GarProcess/stage_3_proc.py |  2 +-
 fias_loader/TESTS/remarks.txt                            | 30 ++++++++++++++++++++++++++++++
 load_main/GarProcess/stage_3_proc.py                     |  2 +-

 
2023-11-15
----------
  Две ошибки, процесс остановлен.
  
  -+ 1) Ошибка в функции поиска двойника
  -+ 2) Необходима гармонизация промежуточных справочников.         Разделить окончательно улицы и адресные пространства,
         ведь по ним, конечном счёте определяется внутренний уровеь объекта.
     
После commit на большом сервере.

$>git commit
[FilterObj c580678] Первый прогон, большой сервер
 Committer: Николай Чадаев <n.chadaev@gd-l-gar-pp-1.abrr.local>
Your name and email address were configured automatically based
on your username and hostname. Please check that they are accurate.
You can suppress this message by setting them explicitly:

    git config --global user.name "Your Name"
    git config --global user.email you@example.com

After doing this, you may fix the identity used for this commit with:

    git commit --amend --reset-author

 4 files changed, 19724 insertions(+)
 create mode 100644 fias_loader/DBMS/process.err
$>

На большом сервере

$>git pull origin FilterObj
remote: Enumerating objects: 27, done.
remote: Counting objects: 100% (27/27), done.
remote: Compressing objects: 100% (5/5), done.
remote: Total 27 (delta 22), reused 27 (delta 22), pack-reused 0
Unpacking objects: 100% (27/27), done.
From https://github.com/NickChadaev/pg_tools
 * branch            FilterObj  -> FETCH_HEAD
Merge made by the 'recursive' strategy.
 fias_loader/DBMS/GAR_FIAS/createTablesGarFias_1.sql              |   3 ++
 fias_loader/DBMS/GAR_TMP_PCG_TRANS/FUNCTION/f_adr_area_get.sql   |  15 ++++--
 fias_loader/DBMS/GAR_TMP_PCG_TRANS/FUNCTION/f_adr_house_get.sql  |  15 ++++--
 fias_loader/DBMS/GAR_TMP_PCG_TRANS/FUNCTION/f_adr_street_get.sql |  10 ++--
 fias_loader/DBMS/GAR_TMP_PCG_TRANS/gar_tmp_trans_pcg.err         | 390 +++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++---------------------------------------------------------------------
 fias_loader/DBMS/GAR_TMP_PCG_TRANS/gar_tmp_trans_pcg.err.bak     | 379 ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++----------------------------------------------------------------
 fias_loader/DBMS/GAR_TMP_PCG_TRANS/gar_tmp_trans_pcg.log         | 176 +++++++++++++++++++++++++++++++-------------------------------
 fias_loader/DBMS/GAR_TMP_PCG_TRANS/gar_tmp_trans_pcg.log.bak     | 176 +++++++++++++++++++++++++++++++-------------------------------
 fias_loader/DBMS/GAR_TMP_PCG_TRANS/gar_tmp_trans_pcg.sql         |  42 ++++++++++-----
 fias_loader/DBMS/GAR_TMP_PCG_TRANS/gar_tmp_trans_pcg.sql.bak     |  90 +++++++++++++++++++++++++++-----
 fias_loader/DBMS/GAR_TMP_PCG_TRANS/stage_25_tmp_build.csv        |   2 +-
 fias_loader/DBMS/GAR_TMP_PCG_TRANS/version.sql                   |   2 +-
 fias_loader/TESTS/Y_BUILD/ALL0/process.out                       |   2 +-
 fias_loader/TESTS/Y_BUILD/_TEST_02_twins.sql                     |  81 +++++++++++++++++++++++++++++
 fias_loader/TESTS/remarks.txt                                    |  10 ++++
 15 files changed, 803 insertions(+), 590 deletions(-)
 create mode 100644 fias_loader/TESTS/Y_BUILD/_TEST_02_twins.sq
 
 
 2023-11-16
 ----------
   -+ 2) Необходима гармонизация промежуточных справочников.  
         В рамках этого пункта необходимо выполнить логическое удаление
         записей из справочников адресных пространств и улиц.
         Тренируемся на 05 127  5434
         
    -+ 3) Как сбросить текущее состояние workers ???
          Убить солдержимое всех таблиц ???
          
     Далее (Big_2):
            -- Установить пакет tmp_proc
            -- патч от 2023-11-15 накатить (гармонизация справочников)
            -- на одной из баз (Big2 01) выполнить второй патч (логическое удаление)
               Предварительно оформить его.
            
$>git pull origin FilterObj
remote: Enumerating objects: 37, done.
remote: Counting objects: 100% (37/37), done.
remote: Compressing objects: 100% (11/11), done.
remote: Total 37 (delta 26), reused 37 (delta 26), pack-reused 0
Unpacking objects: 100% (37/37), done.
From https://github.com/NickChadaev/pg_tools
 * branch            FilterObj  -> FETCH_HEAD
Merge made by the 'recursive' strategy.
 fias_loader/DBMS/GAR_TMP_PCG_TRANS/FUNCTION/f_zzz_adr_area_type_show_tmp_data.sql |   9 +-
 fias_loader/DBMS/GAR_TMP_PCG_TRANS/FUNCTION/f_zzz_house_type_show_tmp_data.sql    |   3 +-
 fias_loader/DBMS/GAR_TMP_PCG_TRANS/FUNCTION/f_zzz_street_type_show_tmp_data.sql   |   8 +-
 fias_loader/DBMS/GAR_TMP_PCG_TRANS/gar_tmp_trans_pcg.err                          | 387 ++++++++++++++++++++++++++++++++++++++++++----------------------------------------
 fias_loader/DBMS/GAR_TMP_PCG_TRANS/gar_tmp_trans_pcg.err.bak                      | 390 ++++++++++++++++++++++++++++++++++++++++++-----------------------------------------
 fias_loader/DBMS/GAR_TMP_PCG_TRANS/gar_tmp_trans_pcg.log                          | 194 ++++++++++++++++++++++-------------------
 fias_loader/DBMS/GAR_TMP_PCG_TRANS/gar_tmp_trans_pcg.log.bak                      | 176 +++++++++++++++++++-------------------
 fias_loader/DBMS/GAR_TMP_PCG_TRANS/gar_tmp_trans_pcg.sql                          | 570 +++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++--
 fias_loader/DBMS/GAR_TMP_PCG_TRANS/gar_tmp_trans_pcg.sql.bak                      |  42 ++++++---
 fias_loader/DBMS/GAR_TMP_PCG_TRANS/stage_25_tmp_build.csv                         |   2 +-
 fias_loader/DBMS/GAR_TMP_PCG_TRANS/version.sql                                    |   2 +-
 fias_loader/DBMS/xxx_all_types_build_patch_20231115.csv                           |  28 ++++++
 fias_loader/DBMS/xxx_all_types_build_patch_20231115.out                           | 174 +++++++++++++++++++++++++++++++++++++
 fias_loader/DBMS/xxx_all_types_build_patch_20231115.sql                           |  59 +++++++++++++
 fias_loader/DBMS/xxx_all_types_build_patch_20231116.sql                           |  46 ++++++++++
 fias_loader/TESTS/Y_BUILD/05/.~lock._TEST_update_level_0.xlsx#                    |   1 +
 fias_loader/TESTS/Y_BUILD/05/.~lock._TEST_xxx_adr_area_type.xlsx#                 |   1 +
 fias_loader/TESTS/Y_BUILD/05/.~lock._TEST_xxx_adr_street_type.csv#                |   1 +
 fias_loader/TESTS/Y_BUILD/05/_TEST_xxx_adr_area_type.csv                          | 234 ++++++++++++++++++++++++++++++--------------------
 fias_loader/TESTS/Y_BUILD/05/_TEST_xxx_adr_area_type.xlsx                         | Bin 0 -> 14940 bytes
 fias_loader/TESTS/Y_BUILD/05/_TEST_xxx_adr_street_type.csv                        | 104 ++++++++++++----------
 fias_loader/TESTS/Y_BUILD/_TEST_02_twins.sql                                      |   4 +-
 fias_loader/TESTS/remarks.txt                                                     |  71 ++++++++++++++-
 23 files changed, 1776 insertions(+), 730 deletions(-)
 create mode 100644 fias_loader/DBMS/xxx_all_types_build_patch_20231115.csv
 create mode 100644 fias_loader/DBMS/xxx_all_types_build_patch_20231115.out
 create mode 100644 fias_loader/DBMS/xxx_all_types_build_patch_20231115.sql
 create mode 100644 fias_loader/DBMS/xxx_all_types_build_patch_20231116.sql
 create mode 100644 fias_loader/TESTS/Y_BUILD/05/.~lock._TEST_update_level_0.xlsx#
 create mode 100644 fias_loader/TESTS/Y_BUILD/05/.~lock._TEST_xxx_adr_area_type.xlsx#
 create mode 100644 fias_loader/TESTS/Y_BUILD/05/.~lock._TEST_xxx_adr_street_type.csv#
 create mode 100644 fias_loader/TESTS/Y_BUILD/05/_TEST_xxx_adr_area_type.xlsx
----------------------------
-- db_exchange -- офрмить в виде функции откат остановленного задания.

Что происходит при работе, ПОТОКИ.
   FIRST   -->  PARSE  <---- workers <--> EVENT_xx --> PROC --> <---- workers <--> EVENT_xx -->  LAST
   
Что я хочу ??

08 Калмыкия                     --   ДОМА В GAPS   2023-11-29 Нормально, ошибка заключалась в отсутствии необходимых родительских типов.
09 Карачаево-Черкесская Респ    --   ДОМА В GAPS   2023-11-29 !!!!!!

32 Белгород, почему происходят обновления ??
34 Волгоград в списке домов поялись явные значения dt_data_del
38 Иркутск 523 GAP_2 !!!!!!!                                    2023-11-29 Осталось всего 4 записи в таблице GAP_2, но 11'670 обнвлений.

Как постобработка домов сочетается с записями о двойниках
46 Курская область, проверить post-обработку домов.
42 Кемерово 252 GAP_2 !!!!!!!                                   2023-11-29 259 записей в GAP_2 !!!!!!!!!!!
47 Ленобласть GAP_2
37 Иваново GAP_2
59 Пермь GAP_2 56

Скверы adr_area adr_street - INTERSECT  adr_area  имя uuid  ДОМА. дети.

1) Пересечение удаляется
2) Остальные перемещаюмся adr_area -->> adr_street


2023-11-20     Второе обновление
----------       1) Управление перемещёнными типами.
                 2) GAP_2
           НЕТ   3) Выключить очитстку GAP-таблиц.
                 4) -- ???? Что ещё выплывет.
                 
   Актуальные задачи                 
          -- Перемещённые типы
          -- и GAP_2 ДОМА  ПОКА 5 И 6 регионы.
          -- ---------------------------------

2023-11-21 - GAP - причины до конца не понятны          
----------
  5 и 6 продолжаем с них.

Нет типов !!!  
  208 | Ферма                   | ферма
  135 | Животноводческая точка  | жт
  134 | Железнодорожная станция | ж/д_ст !!!!!!
  ----------------------------------------------
{73,435,258,134,363}	18	Железнодорожная станция	Железнодорожная станция	ж/д_ст	ж/д_ст
  
    На большом хосте.
  
 * branch            FilterObj  -> FETCH_HEAD
Updating 8ac1959..f7a2ef9
Fast-forward
 fias_loader/DBMS/GAR_TMP_PCG_TRANS/FUNCTION/f_adr_house_ins.sql    |   1 -
 fias_loader/DBMS/GAR_TMP_PCG_TRANS/FUNCTION/f_adr_house_upd.sql    |  41 ++++------
 fias_loader/DBMS/GAR_TMP_PCG_TRANS/gar_tmp_trans_pcg.err           | 373 ++++++++++++++++++++++++++++++++++++++++++--------------------------------------------
 fias_loader/DBMS/GAR_TMP_PCG_TRANS/gar_tmp_trans_pcg.err.bak       | 387 ++++++++++++++++++++++++++++++++++++++++++++++-------------------------------------------
 fias_loader/DBMS/GAR_TMP_PCG_TRANS/gar_tmp_trans_pcg.log           | 194 +++++++++++++++++++++------------------------
 fias_loader/DBMS/GAR_TMP_PCG_TRANS/gar_tmp_trans_pcg.log.bak       | 194 ++++++++++++++++++++++++---------------------
 fias_loader/DBMS/GAR_TMP_PCG_TRANS/gar_tmp_trans_pcg.sql           | 592 ++++------------------------------------------------------------------------------------------------------------------------------------
 fias_loader/DBMS/GAR_TMP_PCG_TRANS/gar_tmp_trans_pcg.sql.bak       | 570 +++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++---
 fias_loader/DBMS/GAR_TMP_PCG_TRANS/stage_25_tmp_build.csv          |   2 +-
 fias_loader/DBMS/GAR_TMP_PCG_TRANS/version.sql                     |   2 +-
 fias_loader/DBMS/process.err                                       |   0
 fias_loader/DBMS/process.sql                                       | 170 ---------------------------------------
 fias_loader/DBMS/{process.log => process_20231116_163501.log}      |   0
 fias_loader/DBMS/{process.out => process_20231116_163501.out}      |   0
 fias_loader/DBMS/xxx_adr_area_type_build_patch_20231121.out        |   8 ++
 fias_loader/DBMS/xxx_adr_area_type_build_patch_20231121.sql        |  70 ++++++++++++++++
 fias_loader/TESTS/Y_BUILD/05/.~lock._TEST_xxx_adr_area_type.xlsx#  |   2 +-
 fias_loader/TESTS/Y_BUILD/05/.~lock._TEST_xxx_adr_street_type.csv# |   2 +-
 fias_loader/TESTS/Y_BUILD/05/_TEST_xxx_adr_area_type.xlsx          | Bin 14974 -> 15011 bytes
 fias_loader/TESTS/Y_BUILD/06/_TEST_GAP_2.sql                       | 223 +++++++++++++++++++++++++++++++++++++++++++++++++++
 fias_loader/TESTS/Y_BUILD/06/_TEST_GAP_3.sql                       | 162 +++++++++++++++++++++++++++++++++++++
 fias_loader/TESTS/Y_BUILD/06/_TEST_GAP_4.sql                       | 105 ++++++++++++++++++++++++
 fias_loader/TESTS/Y_BUILD/_TEST_00_skver.sql                       | 336 +++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
 fias_loader/TESTS/Y_BUILD/_TEST_00_skver.xlsx                      | Bin 0 -> 24295 bytes
 fias_loader/TESTS/remarks.txt                                      |  24 +++++-
 25 files changed, 2095 insertions(+), 1363 deletions(-)
 delete mode 100644 fias_loader/DBMS/process.err
 delete mode 100644 fias_loader/DBMS/process.sql
 rename fias_loader/DBMS/{process.log => process_20231116_163501.log} (100%)
 rename fias_loader/DBMS/{process.out => process_20231116_163501.out} (100%)
 create mode 100644 fias_loader/DBMS/xxx_adr_area_type_build_patch_20231121.out
 create mode 100644 fias_loader/DBMS/xxx_adr_area_type_build_patch_20231121.sql
 create mode 100644 fias_loader/TESTS/Y_BUILD/06/_TEST_GAP_2.sql
 create mode 100644 fias_loader/TESTS/Y_BUILD/06/_TEST_GAP_3.sql
 create mode 100644 fias_loader/TESTS/Y_BUILD/06/_TEST_GAP_4.sql
 create mode 100644 fias_loader/TESTS/Y_BUILD/_TEST_00_skver.sql
 create mode 100644 fias_loader/TESTS/Y_BUILD/_TEST_00_skver.xl
 --
 -- ++ Установить на unnsi_prd_test, c любой региональной БД кластера
 --
 INSERT INTO unnsi.adr_area_type (
      id_area_type
     ,nm_area_type
     ,nm_area_type_short
     ,pr_lead
)
VALUES (  143
         ,'Животноводческая точка'
         ,'жт'
         ,0 
)
,(  144
   ,'Ферма'
   ,'ферма' 
   ,0
);


2023-11-23   
----------

      -+    1) Справочник adr_area_type
      -+    2) Накат patch + обновление процессингового пакета.
      -+?   3) Анализ LOGs, посмотреть убитые ранее дома.  
      
                -- "Километр" уходит в справочник элементов уличной сети
                   на это нужна модификация спрАвочников, как общего, так и xxx_adr....
                
                -- функциии создания/обновления элемента уличной сети      
                   получают дополнение: при поиске "parent", если по завершению
                   поиска id_area IS NULL, то ищем "parent" в элементах уличной сети и 
                   забираем оттуда "id_area".
                   
                -- как плохо, что в adr_street нет отношения подчинённости.
                
                -- процессинговый пакет собираем на ту-же дату, что ивчера.
                
                -- Ещё один patch
                
     Не информативно, либо вводить специальный тип АДРЕСНАЯ ДОРОГА           
                
                   
 
2023-11-24    По новой сборка.   
----------
$>git pull origin FilterObj 
remote: Enumerating objects: 60, done.
remote: Counting objects: 100% (60/60), done.
remote: Compressing objects: 100% (13/13), done.
remote: Total 44 (delta 31), reused 43 (delta 30), pack-reused 0
Unpacking objects: 100% (44/44), done.
From https://github.com/NickChadaev/pg_tools
 * branch            FilterObj  -> FETCH_HEAD
Updating 6fee22b..a285790
Fast-forward
 fias_loader/DBMS/GAR_TMP_PCG_TRANS/FUNCTION/f_adr_street_ins.sql |   16 +-
 fias_loader/DBMS/GAR_TMP_PCG_TRANS/FUNCTION/f_adr_street_upd.sql |   18 +-
 fias_loader/DBMS/GAR_TMP_PCG_TRANS/gar_tmp_trans_pcg.err         |  362 ++++----
 fias_loader/DBMS/GAR_TMP_PCG_TRANS/gar_tmp_trans_pcg.err.bak     |  373 ++++----
 fias_loader/DBMS/GAR_TMP_PCG_TRANS/gar_tmp_trans_pcg.log         |  176 ++--
 fias_loader/DBMS/GAR_TMP_PCG_TRANS/gar_tmp_trans_pcg.log.bak     |  194 ++--
 fias_loader/DBMS/GAR_TMP_PCG_TRANS/gar_tmp_trans_pcg.sql         |   36 +-
 fias_loader/DBMS/GAR_TMP_PCG_TRANS/gar_tmp_trans_pcg.sql.bak     |  592 +------------
 fias_loader/DBMS/GAR_TMP_PCG_TRANS/stage_25_tmp_build.csv        |    2 +-
 fias_loader/DBMS/GAR_TMP_PCG_TRANS/version.sql                   |    2 +-
 fias_loader/DBMS/xxx_adr_area_type_build_patch_20231123.sql      |   66 ++
 fias_loader/TESTS/Y_BUILD/.~lock._TEST_00_skver.xlsx#            |    1 +
 fias_loader/TESTS/Y_BUILD/47/process.err                         |    0
 fias_loader/TESTS/Y_BUILD/47/process.out                         | 6686 +++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
 fias_loader/TESTS/Y_BUILD/47/stage_4.1.sql                       |   22 +
 fias_loader/TESTS/Y_BUILD/47/stage_4.2.sql                       |   21 +
 fias_loader/TESTS/Y_BUILD/47/stage_4.3.sql                       |   21 +
 fias_loader/TESTS/Y_BUILD/47/stage_4.4.sql                       |   21 +
 fias_loader/TESTS/Y_BUILD/47/stage_4.5.sql                       |   24 +
 fias_loader/TESTS/Y_BUILD/47/stage_4.6.sql                       |   22 +
 fias_loader/TESTS/Y_BUILD/_TEST_01_skver.sql                     |  171 ++++
 fias_loader/TESTS/Y_BUILD/_TEST_12_skver.csv                     |    8 +
 fias_loader/TESTS/remarks.txt                                    |   42 +-
 23 files changed, 7703 insertions(+), 1173 deletions(-)
 create mode 100644 fias_loader/DBMS/xxx_adr_area_type_build_patch_20231123.sql
 create mode 100644 fias_loader/TESTS/Y_BUILD/.~lock._TEST_00_skver.xlsx#
 create mode 100644 fias_loader/TESTS/Y_BUILD/47/process.err
 create mode 100644 fias_loader/TESTS/Y_BUILD/47/process.out
 create mode 100644 fias_loader/TESTS/Y_BUILD/47/stage_4.1.sql
 create mode 100644 fias_loader/TESTS/Y_BUILD/47/stage_4.2.sql
 create mode 100644 fias_loader/TESTS/Y_BUILD/47/stage_4.3.sql
 create mode 100644 fias_loader/TESTS/Y_BUILD/47/stage_4.4.sql
 create mode 100644 fias_loader/TESTS/Y_BUILD/47/stage_4.5.sql
 create mode 100644 fias_loader/TESTS/Y_BUILD/47/stage_4.6.sql
 create mode 100644 fias_loader/TESTS/Y_BUILD/_TEST_01_skver.sql
 create mode 100644 fias_loader/TESTS/Y_BUILD/_TEST_12_skver.csv

 
Это то, что приехало на Big_2
-----------------------------
Что далее ??? 

         ++ Пакет для сборки DB-функционала "db_exchange:
         
         ++ Схема  20+10 ??
         
         -- Быстрый буфферизуемый функционал записи (PSYCOPG + хранимки)
            в парсере. 
            
         -+ Убрать parsing не используемых XML-документов                    (время) список определённый в коде load_mainGar.py  
            ====================================================================================================================         
                                                                                     ('s1' in aa[0]) stop-list
                                                                              функция/метод
             db_exchange/pg-perfect-ticker/load_mainGar.py:       self.f_out.write (self.mlc01.ToDo (p_host_ip, p_port, l_db_name, p_user_name, file_name) + bNL)                                                                              
         
         AS_CHANGE_HISTORY_20231120_aa001810-99ff-463c-b8c8-680bbb085385.XML
           /home/n.chadaev@abrr.local/7_DATA/FIAS_GAR_2023_11_20/05/AS_CHANGE_HISTORY_20231120_aa001810-99ff-463c-b8c8-680bbb085385.XML         
         >>> get_file_sign('/home/n.chadaev@abrr.local/7_DATA/FIAS_GAR_2023_11_20/05/AS_CHANGE_HISTORY_20231120_aa001810-99ff-463c-b8c8-680bbb085385.XML')
             'ASCHANGEHISTORY' -- Паттерн запрета.
         
         >>> get_file_sign('AS_CHANGE_HISTORY_20231120_aa001810-99ff-463c-b8c8-680bbb085385.XML')
              'ASCHANGEHISTORY
         
          Понять другое:    ЧЬИ ПАРАМЕТРЫ АГГРЕГИРУЕМ, А КАКИМИ МОЖНО ПРЕНЕБРЕЧЬ.
            
            as_apartments_params
            as_carplaces_params
            as_rooms_params

            Естественно:
                    -- as_apartments
                    -- as_carplaces
                    -- as_rooms
            ---------------------------------------------------------------------------        
            2023-11-28/2023-11-29    Формирование паттернов запрета.

            get_file_sign('AS_CHANGE_HISTORY_20231120_aa001810-99ff-463c-b8c8-680bbb085385.XML')
            ASCHANGEHISTORY
            --
            get_file_sign('AS_NORMATIVE_DOCS_20231127_716bb9d5-4a13-491d-9ec9-56c94f50d397.XML')
            ASNORMATIVEDOCS
            --
            get_file_sign('AS_MUN_HIERARCHY_20231127_ebaacf67-eee1-49cd-a05b-f072fd49981b.XML')
            ASMUNHIERARCHY
            --
            get_file_sign('AS_ROOMS_20231127_732f8f64-48d5-407b-abb5-e7d266d97460.XML')            
            ASROOMS
            --
            get_file_sign('AS_CARPLACES_20231127_a2e77e52-c241-44f0-ac50-51601091625f.XML')
            ASCARPLACES
            --
            get_file_sign('AS_APARTMENTS_20231127_4b94da9d-4de3-4060-994b-aa67cd94f5d6.XML')
            ASAPARTMENTS
            --
            --
            get_file_sign('AS_APARTMENTS_PARAMS_20231127_b96fec89-6038-45f6-a38d-a01624d53f57.XML')
            ASAPARTMENTSPARAMS
            --
            get_file_sign('AS_CARPLACES_PARAMS_20231127_74eb6880-5d57-4ef3-89b0-5fe15d5fad93.XML')
            ASCARPLACESPARAMS
            --
            get_file_sign('AS_ROOMS_PARAMS_20231127_52d91241-351c-491d-a7cc-651a60b47cff.XML')
            ASROOMSPARAMS
            
            
            tSTOP_LIST = ('ASCHANGEHISTORY','ASNORMATIVEDOCS','ASMUNHIERARCHY','ASROOMS','ASCARPLACES','ASAPARTMENTS','ASAPARTMENTSPARAMS','ASCARPLACESPARAMS','ASROOMSPARAMS')
            ===========================================================================
         
         -- Как формировать конфигурационный файл для pg-perfect-ticker ???  (возникали ошибки)
           
           load_mainGar_pt.py --Формирует задания для pg-perfect-ticker
           
           Опции команждной строки:
           #          1       2        3         4           5          6   
           sa = "<Host_IP> <Port> <DB_name> <User_name> <Yaml_file> <Version>"
         
           1 - 4 параметры описывают БД-обмена
           5 - Глобальные и региональные параметры
           6 - Как обычно, дата-версия.
           
       +  Дополнительная таблица:
               event_l0 -- таблица с параметрами для процесса l0
                   ev_type = l0   -- ????
                   ev_data = массив строк, разделённый запятыми.  ????
            
       +    Функции INS_EVENT, GET_EVENT.
         
              'QL0'    cL0 CONSTANT text = 'uio.event_l0';
                       cL0 CONSTANT text = 'uio.event_l0';
                       
           Накатить все обновления на Big_2.
           =================================
         
           В конфигурационном файле "exchage_task.cfg" остается только путь к LOG "pg-perfect-ticker".
           
           !!!!!??????
         
           ============================================================================
         -- Потроха pg-perfect-ticker (потроха Антонова: М либо Ж), 
            когда-то нужно выполнить вскрытие и паталого-анатомическое заключение.

------------------------------------------------------------------------------------            
            db_exchange=# \dx
                      Список установленных расширений
      Имя      | Версия |   Схема    |               Описание               
---------------+--------+------------+--------------------------------------
 pgq           | 3.5    | pg_catalog | Generic queue for PostgreSQL
 plpgsql       | 1.0    | pg_catalog | PL/pgSQL procedural language
 plpgsql_check | 2.3    | public     | extended check for plpgsql functions
(3 строки)

Обязательно усьтановить:
   -- psql -f gar_misc_pcg.sql -p 5434 -U postgres db_exchange 1>r.out 2>r.err
   
Пришло на Big_2

$>git pull origin FilterObj 
remote: Enumerating objects: 23, done.
remote: Counting objects: 100% (23/23), done.
remote: Compressing objects: 100% (3/3), done.
remote: Total 12 (delta 9), reused 12 (delta 9), pack-reused 0
Unpacking objects: 100% (12/12), done.
From https://github.com/NickChadaev/pg_tools
 * branch            FilterObj  -> FETCH_HEAD
Updating d6e39f0..3365391
Fast-forward
 db_exchange/UIO/db_exchange_pcg.err      |   2 +-
 db_exchange/UIO/db_exchange_pcg.err.bak  |   2 +-
 db_exchange/UIO/db_exchange_pcg.log      |  16 ++++++------
 db_exchange/UIO/db_exchange_pcg.log.bak  |  16 ++++++------
 db_exchange/UIO/db_exchange_pcg.sql      |  20 ++++++++++++---
 db_exchange/UIO/db_exchange_pcg.sql.bak  | 225 +++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++-----
 db_exchange/UIO/stage_25_db_exchange.csv |   2 +-
 db_exchange/UIO/version.sql              |   2 +-
 fias_loader/TESTS/remarks.txt            |  12 +++++++++
 9 files changed, 268 insertions(+), 29 deletions(-)
$>

25606|'2023-11-28 12:30:58'|'last_0'|'2023-11-28T12:30:58.275676|2023-11-20|/home/n.chadaev@abrr.local/stage_6.yaml|/home/n.chadaev@abrr.local/Y_BUILD/post_proc_l.sh|/home/n.chadaev@abrr.local/tmp|n.chadaev|domain users'

$>python3 l0.py 
(4080,)
(25948, datetime.datetime(2023, 11, 28, 16, 6, 56), 'last_0', '2023-11-28T16:06:56.202803|2023-11-20|/home/rootadmin/abr_upload/stage_6.yaml|/home/rootadmin/abr_upload/Y_BUILD/post_proc_l.sh|/home/rootadmin/abr_upload/tmp|n.chadaev|domain users', None, None, None, None)
2023-11-28T16:06:56.202803
2023-11-20
/home/rootadmin/abr_upload/stage_6.yaml
/home/rootadmin/abr_upload/Y_BUILD/post_proc_l.sh
/home/rootadmin/abr_upload/tmp
n.chadaev
domain users
/home/rootadmin/abr_upload/Y_BUILD/post_proc_l.sh /home/rootadmin/abr_upload/tmp up_prdl_20231120 'n.chadaev' 'domain users' 1>> /var/log/pg-perfect-ticker/exchange.log 2>> /var/log/pg-perfect-ticker/exchange.log
$>

Упало на Big-2
--------------
$>git pull origin FilterObj
From https://github.com/NickChadaev/pg_tools
 * branch            FilterObj  -> FETCH_HEAD
Updating 3365391..ccb9b78
Fast-forward
 db_exchange/hosts_common_xxx_all_pt.yaml                                                      | 525 +++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
 db_exchange/load_mainGar_pt.py                                                                | 204 ++++++++++++++++++++++++++++++++++++++++++
 db_exchange/pg-perfect-ticker/exchange-scripts/l0.py                                          |  91 +++++++++++++------
 db_exchange/pg-perfect-ticker/exchange-tasks.cfg                                              |   7 --
 db_exchange/pg-perfect-ticker/lib_pg_perfect_ticker/__init__.pyc                              | Bin 0 -> 183 bytes
 db_exchange/pg-perfect-ticker/lib_pg_perfect_ticker/__pycache__/__init__.cpython-36.pyc       | Bin 0 -> 179 bytes
 db_exchange/pg-perfect-ticker/lib_pg_perfect_ticker/__pycache__/log.cpython-36.pyc            | Bin 0 -> 963 bytes
 db_exchange/pg-perfect-ticker/lib_pg_perfect_ticker/__pycache__/simple_db_pool.cpython-36.pyc | Bin 0 -> 2087 bytes
 db_exchange/pg-perfect-ticker/lib_pg_perfect_ticker/simple_db_pool.pyc                        | Bin 0 -> 3018 bytes
 fias_loader/TESTS/remarks.txt                                                                 |  46 +++++++---
 10 files changed, 826 insertions(+), 47 deletions(-)
 create mode 100644 db_exchange/hosts_common_xxx_all_pt.yaml
 create mode 100755 db_exchange/load_mainGar_pt.py
 create mode 100644 db_exchange/pg-perfect-ticker/lib_pg_perfect_ticker/__init__.pyc
 create mode 100644 db_exchange/pg-perfect-ticker/lib_pg_perfect_ticker/__pycache__/__init__.cpython-36.pyc
 create mode 100644 db_exchange/pg-perfect-ticker/lib_pg_perfect_ticker/__pycache__/log.cpython-36.pyc
 create mode 100644 db_exchange/pg-perfect-ticker/lib_pg_perfect_ticker/__pycache__/simple_db_pool.cpython-36.pyc
 create mode 100644 db_exchange/pg-perfect-ticker/lib_pg_perfect_ticker/simple_db_pool.pyc
$>


2023-11-30 --
-------------
  На Big_2  Новые версии  load_mainGar.py
            Новый конфигурационный файл pg-lib_pg_perfect_ticker
            Исправить запускалку
--    
hosts_common_xxx_all_pt.yaml

$>load_mainGar_pt.py
  Version 0.1.0 Build 2023-11-27
  Usage: /usr/local/bin/load_mainGar_pt.py <Host_IP> <Port> <DB_name> <User_name> <Yaml_file> <Version>
---
  
  Сохранить рабочие каталоги с logs
  
  Что творилось с 17 регионом             (в работе участвуют "запрещённые" типы.)
  ---------- Как происходило массовое обновлениеп.
  
 I       | 1700192172 |      11879 | 1700003763 |               2 | 11         |                 |            |                 |            |            | д. 11            | 92634468101 | 87fde65d-9fb6-4669-9a3
 U       |   30142211 |      14661 |     260329 |               2 | 77         |                 |            |                 |            |            | д. 77            | 92648455101 | 1aee8c90-f612-459c-a8b
 U       |   29574156 |     174715 |     908113 |               2 | 52     
 
GAP_2 
 
-- 05 Дагестан 
-- 08 Калмыкия                     --   ДОМА В GAPS   2023-11-29 Нормально, ошибка заключалась в отсутствии необходимых родительских типов.

-- 09 Карачаево-Черкесская Респ    --   ДОМА В GAPS   2023-11-29 !!!!!!  ОНС  - пронятно

2023-11-30  брянск      region = 32
 id_house | id_addr_parent |             nm_fias_guid             |         nm_fias_guid_parent          |         nm_parent_obj          | region_code | parent_type_id | parent_type_name | parent_type_shortname
----------+----------------+--------------------------------------+--------------------------------------+--------------------------------+-------------+----------------+------------------+----------------------
 17979974 |         495565 | a849b896-c653-4d5c-ad75-5232de67a0ee | 8b1f388f-8749-4447-be5a-338814fd3e33 | ДОС-2(дом офицерского состава) | 32          |            198 | Строение         | стр           
 19449808 |         489854 | b6ff0eef-367c-4e73-a5a2-d471968e2dd2 | e3fdf321-ca1c-4f4d-905f-37f49f654c15 | ДОС-1(дом офицерского состава) | 32          |            198 | Строение         | стр           
(2 rows)

Этого быть не может ишем родителей только в улицах, либо в адресных регионах.

32 Белгород, почему происходят обновления ??
34 Волгоград в списке домов поялись явные значения dt_data_del
38 Иркутск 523 GAP_2 !!!!!!!                                    2023-11-29 Осталось всего 4 записи в таблице GAP_2, но 11'670 обнвлений.
------------------------------------------------------------------------------------
 id_house  | id_addr_parent |             nm_fias_guid             |         nm_fias_guid_parent          | nm_parent_obj  | region_code | parent_type_id | parent_type_name | parent_type_shortname | parent_level
-----------+----------------+--------------------------------------+--------------------------------------+----------------+-------------+----------------+------------------+-----------------------+-------------
  98589535 |         603846 | bafb64c8-5e73-43a3-acb3-33f6382c74aa | b4f4095d-d0d1-4014-861b-15e89e2805e6 | Молотовая      | 38          |            204 | Улица            | ул                    |      
  99316856 |         606741 | e80f6b8b-bee4-4b5d-b98b-81ffb3835adf | d8419d82-4527-4d3a-8f87-1ce81667767f | Индустриальная | 38          |            204 | Улица            | ул                    |      
  99316872 |         606741 | 65484bb1-06e6-4cdf-9f8d-29d71e2e8855 | d8419d82-4527-4d3a-8f87-1ce81667767f | Индустриальная | 38          |            204 | Улица            | ул                    |      
 158110725 |         606741 | 4a008a4c-1885-47fd-b77c-4423653dc18c | d8419d82-4527-4d3a-8f87-1ce81667767f | Индустриальная | 38          |            204 | Улица            | ул                    |      
(4 rows)
------------------------------------------------------------------------------------
Как постобработка домов сочетается с записями о двойниках
46 Курская область, проверить post-обработку домов.
42 Кемерово 252 GAP_2 !!!!!!!                                   2023-11-29 259 записей в GAP_2 !!!!!!!!!!!
47 Ленобласть GAP_2
37 Иваново GAP_2
59 Пермь GAP_2 56


2023-12-02
---------- 
----------
50 региона
{100,291,338}	39	Промышленная зона	Промышленная зона	промзона	промзона	0	промышленнаязона
+177  

2023-12-02 12:56:08,966 INFO pg-perfect-ticker *** Qty of processed regions: 84 ***
2023-12-02 

!!! extras4 обновить  <==  '+'  !!!!            Всё ОК   Сколько можно наступать на одни ите-же грабли.



2023-12-06
-----------------------------------------------------------------------
47 Спб обл --GAP2
47          |            190 | Съезд            | сзд.   

190|'8'|'Съезд'|'сзд.'|'Съезд'|'2015-11-05'|'2015-11-05'|'2018-11-09'|t



2024-01-11
----------
Разребаю последствия слияния !!!!!!
-----------------------------------
erge made by the 'recursive' strategy.
 fias_loader/DBMS/GAR_TMP_PCG_TRANS/FUNCTION/f_adr_area_ins.sql            |    44 +-
 fias_loader/DBMS/GAR_TMP_PCG_TRANS/FUNCTION/f_adr_area_upd.sql            |    13 +
 fias_loader/DBMS/GAR_TMP_PCG_TRANS/FUNCTION/f_adr_house_ins.sql           |    13 +
 fias_loader/DBMS/GAR_TMP_PCG_TRANS/FUNCTION/f_adr_house_upd.sql           |    27 +
 fias_loader/DBMS/GAR_TMP_PCG_TRANS/FUNCTION/f_adr_street_ins.sql          |    22 +
 fias_loader/DBMS/GAR_TMP_PCG_TRANS/FUNCTION/f_adr_street_upd.sql          |    22 +
 fias_loader/DBMS/GAR_TMP_PCG_TRANS/FUNCTION/f_xxx_adr_area_show_data.sql  |    13 +
 fias_loader/DBMS/GAR_TMP_PCG_TRANS/PROCEDURE/p_xxx_adr_area_gap_put.sql   |    25 +-
 fias_loader/DBMS/GAR_TMP_PCG_TRANS/PROCEDURE/p_xxx_adr_house_gap_put.sql  |    36 +-
 fias_loader/DBMS/GAR_TMP_PCG_TRANS/PROCEDURE/p_xxx_adr_street_gap_put.sql |    24 +-
 fias_loader/DBMS/GAR_TMP_PCG_TRANS/gar_tmp_trans_pcg.err                  |   247 +++
 fias_loader/DBMS/GAR_TMP_PCG_TRANS/gar_tmp_trans_pcg.err.bak              |   215 +++
 fias_loader/DBMS/GAR_TMP_PCG_TRANS/gar_tmp_trans_pcg.log                  |    91 +
 fias_loader/DBMS/GAR_TMP_PCG_TRANS/gar_tmp_trans_pcg.log.bak              |    91 +
 fias_loader/DBMS/GAR_TMP_PCG_TRANS/gar_tmp_trans_pcg.sql                  |   243 ++-
 fias_loader/DBMS/GAR_TMP_PCG_TRANS/gar_tmp_trans_pcg.sql.bak              |    22 +
 fias_loader/DBMS/GAR_TMP_PCG_TRANS/stage_25_tmp_build.csv                 |     4 +
 fias_loader/DBMS/GAR_TMP_PCG_TRANS/version.sql                            |     4 +
 fias_loader/TESTS/X0_crt_view.sql                                         |   339 ++++
 fias_loader/TESTS/Y_BUILD/05/.~lock._TEST_xxx_adr_area_type.xlsx#         |     1 -
 fias_loader/TESTS/Y_BUILD/05/.~lock._TEST_xxx_adr_street_type.csv#        |     1 -
 fias_loader/TESTS/Y_BUILD/05/_TEST_xxx_adr_area_type.xlsx                 |   Bin 15011 -> 15373 bytes
 fias_loader/TESTS/Y_BUILD/05/_TEST_xxx_adr_street_type.csv                |   114 +-
 fias_loader/TESTS/Y_BUILD/05/l.err                                        |   342 ++++
 fias_loader/TESTS/Y_BUILD/05/l.out                                        |   295 ++++
 fias_loader/TESTS/Y_BUILD/05/stage_4.1.sql                                |    13 +-
 fias_loader/TESTS/Y_BUILD/05/stage_4.2.sql                                |    10 +
 fias_loader/TESTS/Y_BUILD/05/stage_4.3.sql                                |     9 +-
 fias_loader/TESTS/Y_BUILD/05/stage_4.4.sql                                |    10 +
 fias_loader/TESTS/Y_BUILD/05/stage_4.5.sql                                |     9 +
 fias_loader/TESTS/Y_BUILD/05/stage_4.6.sql                                |    14 +-
 fias_loader/TESTS/Y_BUILD/05/t411.err                                     |     0
 fias_loader/TESTS/Y_BUILD/05/t411.out                                     |    94 ++
 fias_loader/TESTS/Y_BUILD/05/t421.err                                     |     0
 fias_loader/TESTS/Y_BUILD/05/t421.out                                     |    88 +
 fias_loader/TESTS/Y_BUILD/05/t431.err                                     |     0
 fias_loader/TESTS/Y_BUILD/05/t431.out                                     |   214 +++
 fias_loader/TESTS/Y_BUILD/05/t441.err                                     |     0
 fias_loader/TESTS/Y_BUILD/05/t441.out                                     |   379 +++++
 fias_loader/TESTS/Y_BUILD/05/t451.err                                     |     0
 fias_loader/TESTS/Y_BUILD/05/t451.out                                     |   864 ++++++++++
 fias_loader/TESTS/Y_BUILD/05/t461.err                                     |     0
 fias_loader/TESTS/Y_BUILD/05/t461.out                                     |  1582 +++++++++++++++++
 fias_loader/TESTS/Y_BUILD/50/stage_4.1.sql                                |    13 +
 fias_loader/TESTS/Y_BUILD/50/stage_4.2.sql                                |    11 +
 fias_loader/TESTS/Y_BUILD/50/stage_4.3.sql                                |    10 +
 fias_loader/TESTS/Y_BUILD/50/stage_4.4.sql                                |    10 +
 fias_loader/TESTS/Y_BUILD/50/stage_4.5.sql                                |    12 +
 fias_loader/TESTS/Y_BUILD/50/stage_4.6.sql                                |    15 +
 fias_loader/TESTS/Y_BUILD/50/t41.err                                      |     0
 fias_loader/TESTS/Y_BUILD/50/t41.out                                      |    51 +
 fias_loader/TESTS/Y_BUILD/50/t42.err                                      |     0
 fias_loader/TESTS/Y_BUILD/50/t42.out                                      |    56 +
 fias_loader/TESTS/Y_BUILD/50/t43.err                                      |     0
 fias_loader/TESTS/Y_BUILD/50/t43.out                                      |   238 +++
 fias_loader/TESTS/Y_BUILD/50/t44.err                                      |     0
 fias_loader/TESTS/Y_BUILD/50/t44.out                                      |   253 +++
 fias_loader/TESTS/Y_BUILD/50/t45.err                                      |     0
 fias_loader/TESTS/Y_BUILD/50/t45.out                                      |  1814 ++++++++++++++++++++
 fias_loader/TESTS/Y_BUILD/50/t46.err                                      |     0
 fias_loader/TESTS/Y_BUILD/50/t46.out                                      | 11758 +++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
 fias_loader/TESTS/remarks.txt                                             |   164 ++
 62 files changed, 19715 insertions(+), 224 deletions(-)
 create mode 100644 fias_loader/TESTS/X0_crt_view.sql
 delete mode 100644 fias_loader/TESTS/Y_BUILD/05/.~lock._TEST_xxx_adr_area_type.xlsx#
 delete mode 100644 fias_loader/TESTS/Y_BUILD/05/.~lock._TEST_xxx_adr_street_type.csv#
 create mode 100644 fias_loader/TESTS/Y_BUILD/05/l.err
 create mode 100644 fias_loader/TESTS/Y_BUILD/05/l.out
 create mode 100644 fias_loader/TESTS/Y_BUILD/05/t411.err
 create mode 100644 fias_loader/TESTS/Y_BUILD/05/t411.out
 create mode 100644 fias_loader/TESTS/Y_BUILD/05/t421.err
 create mode 100644 fias_loader/TESTS/Y_BUILD/05/t421.out
 create mode 100644 fias_loader/TESTS/Y_BUILD/05/t431.err
 create mode 100644 fias_loader/TESTS/Y_BUILD/05/t431.out
 create mode 100644 fias_loader/TESTS/Y_BUILD/05/t441.err
 create mode 100644 fias_loader/TESTS/Y_BUILD/05/t441.out
 create mode 100644 fias_loader/TESTS/Y_BUILD/05/t451.err
 create mode 100644 fias_loader/TESTS/Y_BUILD/05/t451.out
 create mode 100644 fias_loader/TESTS/Y_BUILD/05/t461.err
 create mode 100644 fias_loader/TESTS/Y_BUILD/05/t461.out
 create mode 100644 fias_loader/TESTS/Y_BUILD/50/t41.err
 create mode 100644 fias_loader/TESTS/Y_BUILD/50/t41.out
 create mode 100644 fias_loader/TESTS/Y_BUILD/50/t42.err
 create mode 100644 fias_loader/TESTS/Y_BUILD/50/t42.out
 create mode 100644 fias_loader/TESTS/Y_BUILD/50/t43.err
 create mode 100644 fias_loader/TESTS/Y_BUILD/50/t43.out
 create mode 100644 fias_loader/TESTS/Y_BUILD/50/t44.err
 create mode 100644 fias_loader/TESTS/Y_BUILD/50/t44.out
 create mode 100644 fias_loader/TESTS/Y_BUILD/50/t45.err
 create mode 100644 fias_loader/TESTS/Y_BUILD/50/t45.out
 create mode 100644 fias_loader/TESTS/Y_BUILD/50/t46.err
 create mode 100644 fias_loader/TESTS/Y_BUILD/50/t46.out
$>

Итоги  Merge request не создаём (непонимаю)
всё в командной строке и помнить о наличии двух
репозиториев.

2024-01-20 Пока костыль в master
---------------------------------

  -+  1) База - выгрузить обновлённый dump.
  -+  2) Обновления, выложить
  -+  3) Эталон postgres_fdw
  --  4) диаграмма процесса подготовки. (см. "remarks-5.txt", db_exchange_2
  -+  5) Процедуры для "точечного" обновления. ТРЕБОВАНИЯ.
            -- Усечённый набор параметров, аргумент UUID, (id_rec не меняется вообще. )
            -- Все фактические аргументы по умолчанию NULL
            -- Выполнение
                 -- Запрос фактического состояния по UUID    
                 -- Замена фактических аргументов имеющих NULL в значении.
                    на фактические данные.
                 -- Вызов обновляющей процедуры/функции.
            -- Место вызова: сценарии для post-обработки. (строго до 6-го этапа)

SELECT gar_link.f_server_crt ('unnsi_prd_et', '127.0.0.1', 'unnsi_prd_et', 5432, 
             'postgres', 'postgres', '');
-----------------------------------------
SELECT gar_link.f_server_crt ('unnsi_prd_et', '10.196.35.165', 'unnsi_prd_et', 5432, 
             'postgres', 'postgres', '');
-----------------------------------------
             
SELECT gar_link.f_schema_import ('unnsi_prd_et', 'unnsi', 'unsi', 'ЭТАЛОН от 2022-12-15');


fBVTBXPx47F$

-- ============================================================================================

Olga Aktiranova, [12.02.2024 13:05]
Так

Olga Aktiranova, [12.02.2024 13:05]
Я сейчас на планерке

Olga Aktiranova, [12.02.2024 13:05]
Но от Филимонова

Olga Aktiranova, [12.02.2024 13:05]
https://gitlab.abr-region.ru/a.chupin/kktadapter/-/tree/main/src/main/java/ru/abrr

Olga Aktiranova, [12.02.2024 13:05]
CheckNewReceiptScheduler.checkReceipt
StateReceiptScheduler.checkReceipt
Controller

Olga Aktiranova, [12.02.2024 13:06]
Один шедулер к потокам на отправку
Второй на опрос по ожиданию

Olga Aktiranova, [12.02.2024 13:06]
У нас нет здесь ни Кафки, не Рэббита

Olga Aktiranova, [12.02.2024 13:06]
Все делает просто приложение

Olga Aktiranova, [12.02.2024 13:06]
Асинхронная реализация

Olga Aktiranova, [12.02.2024 13:07]
1 чек в 1 секунду на отправку
Не больше 3-х запросов на 1 поток
0,7 секунд ожидания по запросу (sleep в алгоритме)

Olga Aktiranova, [12.02.2024 13:08]
Примерно 86400 тысяч чеков в сутки получается

Olga Aktiranova, [12.02.2024 13:09]
У нас 3 потока - то есть три кассы у Организации МОE
----------------------------------------------------



2024-04-16  Новые требования к обработке адесов.
------------------------------------------------
Республика Дагестан, городской округ город Дербент, город Дербент, улица Азовская д.16
Республика Дагестан, город Дербент, улица Азовская д.16
--
21ab76d1-fab6-4b4f-a4dc-4871a93b7aab

Георегион, составное наименование гео-региона.  Значит их два и родителей то-же два.
Либо  две отдельных иерархии:  отношение "родитель-ребёнок" 
и отдельно плоская таблица "гео-регионы".

Адреса представляются в виде m-view, которые обновляются и индексируются в процессе
полной, либо инкрементальной загрузки.

Два представления:   m_adr_area_adm  m_adr_area_mun  первое должно совпадать с существующенй
таблицей adr_area.  Второе -- это муниципальные образования.

Прежде этого модификация загрузчиа:


Команды 7 и 8 (модификация 01, 1) но только в том случае, если БД указанная в командной строке,\
совпадает с БД из CSV-сценария.


